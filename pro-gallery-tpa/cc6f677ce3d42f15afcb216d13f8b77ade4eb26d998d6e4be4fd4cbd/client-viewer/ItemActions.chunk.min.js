"use strict";(("undefined"!=typeof self?self:this).webpackJsonp__wix_pro_gallery_tpa=("undefined"!=typeof self?self:this).webpackJsonp__wix_pro_gallery_tpa||[]).push([[319],{5419:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I,itemActions:()=>S});var r=o(5823),i=o(6252),n=o.n(i),s=o(1064),a=o(7331),c=o(6484),l=o(5745),p=o(7899),h=new p.Q,d="love",u="love",v="loveCountFromStats",g=function(){function e(){this.getEncodedContextToken=this.getEncodedContextToken.bind(this),this.parseReactionServiceResponse=this.parseReactionServiceResponse.bind(this),this.newParseReactionServiceResponse=this.newParseReactionServiceResponse.bind(this)}return e.prototype.getItemsLoveData=function(e,t,o,i,n){return(0,r.sH)(this,void 0,void 0,(function(){var a,c,l,p,d,u,v;return(0,r.YH)(this,(function(r){switch(r.label){case 0:a=this.getEncodedContextToken(i,n),c=e.map((function(e){return e.itemId})),l=c.join("&resourceIds="),p="".concat(o,"/_api/reactions-server/v1/reactions?contextToken=").concat(a,"&resourceIds=").concat(l),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,h.get(p,{headers:{"Content-Type":"application/json",Authorization:t}})];case 2:return 200===(d=r.sent()).status?(u=d.data.responses,[2,this.newParseReactionServiceResponse(u)]):(s.v.isVerbose()&&console.error("Reaction-Service error - GET call response status: ".concat(d.status)),[2,{error:"Reaction-Service error - GET call response status: ".concat(d.status)}]);case 3:return v=r.sent(),s.v.isVerbose()&&console.error("Reaction-Service error - some error when requesting data from reaction-service: ".concat(v.message)),[2,{error:"Reaction-Service error - some error when requesting data from reaction-service: ".concat(v.message)}];case 4:return[2]}}))}))},e.prototype.toggleItemLove=function(e,t,o,i,n,a){return(0,r.sH)(this,void 0,void 0,(function(){var c,l,p,d,v,g;return(0,r.YH)(this,(function(r){switch(r.label){case 0:c=this.getEncodedContextToken(n,a),l=u,p="".concat(i,"/_api/reactions-server/v1/reactions/").concat(e,"/").concat(l,"?contextToken=").concat(c),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,h.request({url:p,method:t,headers:{"Content-Type":"application/json",Authorization:o}})];case 2:return 200===(d=r.sent()).status&&(v=d.data,s.v.isVerbose()&&console.log("Succeeded ".concat(t," action of Reactions service for item ").concat(e,". response: ").concat(v))),[3,4];case 3:return g=r.sent(),s.v.isVerbose()&&console.error("Failed ".concat(t," action of Reactions service for item ").concat(e,". ").concat(g)),[2,{responses:"some error when requesting from reactions service"+p+g.message}];case 4:return[2]}}))}))},e.prototype.mergeDataFromStatsToReactionService=function(e,t,o,i,n,a){return(0,r.sH)(this,void 0,void 0,(function(){var c,l,p,d,u,g;return(0,r.YH)(this,(function(r){switch(r.label){case 0:c=this.getEncodedContextToken(n,a),l="".concat(i,"/_api/reactions-server/v1/reactions/").concat(e,"/add-reaction?contextToken=").concat(c),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,h.post(l,JSON.stringify({reaction:{reactionCode:v,reactionParams:{count:String(t)}}}),{headers:{"Content-Type":"application/json",Authorization:o}})];case 2:return 200===(p=r.sent()).status?(d=p.data,s.v.isVerbose()&&console.log("Succeeded to POST old love counts from stats to Reactions service for item ".concat(e,". response: ").concat(d)),[2,{status:p.status,message:"success"}]):(u=p.data.message,[2,{status:p.status,message:u}]);case 3:return g=r.sent(),s.v.isVerbose()&&console.error("Failed to POST old love counts from stats to Reactions service for item ".concat(e,". ").concat(g)),[2,{responses:"some error when requesting from reactions service"+l+g.message}];case 4:return[2]}}))}))},e.prototype.isLovedByCurrentVisitor=function(e,t,o){var r,i;try{if(o){var n=null===(i=null===(r=o[e])||void 0===r?void 0:r.identityReactions)||void 0===i?void 0:i.reactions;return(null==n?void 0:n.findIndex((function(e){return e.identity.identityId===t&&e.reaction.reactionCode===u})))>-1}}catch(e){console.warn("isLovedByCurrentVisitor failed",e)}},e.prototype.parseReactionServiceResponse=function(e){var t;try{for(var o={},r=function(e,r){o[e]=0;var i=null===(t=r.identityReactions)||void 0===t?void 0:t.reactions,n=!1;i.forEach((function(t){var r,i,s;switch(null===(r=t.reaction)||void 0===r?void 0:r.reactionCode){case v:n||(o[e]+=Number(null===(s=null===(i=t.reaction)||void 0===i?void 0:i.reactionParams)||void 0===s?void 0:s.count),n=!0);break;case u:o[e]+=1}}))},i=0,n=Object.entries(e);i<n.length;i++){var a=n[i];r(a[0],a[1])}return o}catch(e){return s.v.isVerbose()&&console.error("Reaction-Service error - problem with parsing response: ".concat(e.message)),{error:"Reaction-Service error - problem with parsing response: ".concat(e.message)}}},e.prototype.newParseReactionServiceResponse=function(e){var t,o,r,i;try{for(var n={},a=0,c=Object.entries(e);a<c.length;a++){var l=c[a],p=l[0],h=l[1];n[p]=0;var d=null===(t=h.identityReactions)||void 0===t?void 0:t.reactions[0];if(d){if((null===(o=d.reaction)||void 0===o?void 0:o.reactionCode)===v)n[p]+=Number(null===(i=null===(r=d.reaction)||void 0===r?void 0:r.reactionParams)||void 0===i?void 0:i.count);else n[p]+=1;n[p]+=Math.max(0,h.total-1)}else n[p]+=Math.max(0,h.total)}return n}catch(e){return s.v.isVerbose()&&console.error("Reaction-Service error - problem with new parsing response: ".concat(e.message)),{error:"Reaction-Service error - problem with new parsing response: ".concat(e.message)}}},e.prototype.shouldUseReactionService=function(){return!0},e.prototype.getEncodedContextToken=function(e,t){var o={authorizerAppDefId:t,contextId:e,contextType:d};return encodeURIComponent(JSON.stringify(o))},e.prototype.sampleMigrationSuccessRate=function(e,t,o){var r;try{if(Object.keys(e).length>0&&Object.keys(t).length>0){var i=Object.keys(e).length,n=(r=i,Math.floor(Math.random()*Math.floor(r))),s=Object.keys(e)[n],a=e[s],c=t.hasOwnProperty(s)&&t[s]||null;t.hasOwnProperty(s)?a<=c+2&&a>=c-2?"function"==typeof o&&o("Reaction-Service Migration 3rd try - Sample is successful"):"function"==typeof o&&o("Reaction-Service Migration 3rd try - Sample is failure"):"function"==typeof o&&o("Reaction-Service Migration 3rd try - Item doesnt exist in stats response")}else"function"==typeof o&&o("Reaction-Service Migration 3rd try - reactionService and stats responses are empty")}catch(e){"function"==typeof o&&o("Reaction-Service Migration 3rd try - Error in sampleMigrationSuccessRate")}},e}();var y=new g,f=new p.Q,m=function(){function e(){this.getLoveCount=this.getLoveCount.bind(this),this.wasInit=!1,this.loveCounts={},this.fetchSiteInfo(),this.isRemoveUseOfCounterApiEnabled=!0}return e.prototype.initWidgetData=function(e){if(this.config=e,e.instance&&(this.instance=e.instance),e.items&&(this.items=e.items),e.visitorId&&(this.visitorId=e.visitorId),e.appDefinitionId&&(this.appDefinitionId=e.appDefinitionId),e.Report&&(this.Report=e.Report),e.reportMigratedLoveDataBiEvent&&(this.reportMigratedLoveDataBiEvent=e.reportMigratedLoveDataBiEvent),e.compId&&(this.compId=e.compId),e.pageId&&(this.pageId=e.pageId),e.styleId&&(this.styleId=e.styleId),e.pageUrl&&(this.pageUrl=e.pageUrl),"boolean"==typeof e.isStoreGallery&&(this.isStoreGallery=e.isStoreGallery),"boolean"==typeof e.shouldUseGalleryIdForShareUrl&&(this.shouldUseGalleryIdForShareUrl=e.shouldUseGalleryIdForShareUrl),e.galleryId&&(this.galleryId=e.galleryId),e.viewMode&&(this.viewMode=e.viewMode.toLowerCase()),e.fullscreenUrl){this.siteUrl=this.fullscreenUrl=this.normalizeFullscreenUrl(e.fullscreenUrl);try{this.siteUrl=this.fullscreenUrl.match(/.*\..*\//g)[0]}catch(e){}}return e.onLoveCountsFetched&&(this.onLoveCountsFetched=e.onLoveCountsFetched),this.baseUrl=e.baseUrl||"//progallery.wixapps.net",e.reachLevel&&this.setReachLevel(e.reachLevel),!s.v.isSSR()&&"site"===this.viewMode&&this.galleryId&&""!==this.galleryId&&this.getStats(),this.wasInit=e,Date.now()},e.prototype.setItemsLoveData=function(e){var t=e.itemsLoveData;if(t){this.reactionsServiceResponse=t;var o=y.newParseReactionServiceResponse(t);this.onLoveCountsFetched(o)}},e.prototype.normalizeFullscreenUrl=function(e){var t=e;return e&&(t=e.split("?")[0]),t},e.prototype.fetchSiteInfo=function(){var e,t=this;try{e=l.A.location.href}catch(t){e=""}s.v.isInWix()?(this.siteInfo={},a.A.getSiteInfo((function(e){t.siteInfo=e}))):this.siteInfo={url:e,baseUrl:e,siteTitle:"Wix Pro Gallery",siteDescription:"The best gallery any Wix user has ever seen!",siteKeywords:"gallery,photos,photographer,professional"}},e.prototype.getSiteUrl=function(){return this.siteInfo.url},e.prototype.getStats=function(){return(0,r.sH)(this,void 0,void 0,(function(){var e=this;return(0,r.YH)(this,(function(t){switch(t.label){case 0:return"site"!==this.viewMode||s.v.isDev()||s.v.isTest()?[2]:!this.galleryId||""===this.galleryId||this.galleryId.length<10?(console.log("galleryId id",this.galleryId,typeof this.galleryId),console.error("get stats error - no galleryId"),[2]):(f.get("".concat(this.baseUrl,"/pro-gallery-webapp/api/v1/gallery/").concat(this.galleryId,"/stats/properties?cache_buster=").concat(Math.random())).then((function(t){try{t.data.properties?e.statsProps=JSON.parse(t.data.properties):t.data.statsToken&&(e.statsProps={instance_id:e.config.instanceId,set_id:e.galleryId}),e.statsToken=t.data.statsToken}catch(e){console.error("Failed getting stats props",e)}})),[4,this.migrateLoveDataFromStatsToReactionService()]);case 1:return t.sent(),y.shouldUseReactionService()||this.getLoveDataWithOriginalFunction(),[2]}}))}))},e.prototype.migrateLoveDataFromStatsToReactionService=function(){return(0,r.sH)(this,void 0,void 0,(function(){var e,t,o,i,n,a,c,l,p,h,d;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,8,,9]),[4,y.getItemsLoveData(this.items,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)];case 1:return(e=r.sent()).hasOwnProperty("error")?("function"==typeof this.Report&&(d=e.error,this.Report(d)),[2]):this.isRemoveUseOfCounterApiEnabled?[3,3]:[4,this.getLoveDataUsingStatsApi()];case 2:t=r.sent(),y.sampleMigrationSuccessRate(e,t,this.Report),r.label=3;case 3:return 0!==Object.keys(e).length||this.isRemoveUseOfCounterApiEnabled?[3,7]:[4,this.getLoveDataUsingStatsApi()];case 4:if(t=r.sent(),!(Object.keys(t).length>0))return[3,7];for("function"==typeof this.reportMigratedLoveDataBiEvent&&this.reportMigratedLoveDataBiEvent({galleryId:this.galleryId,migrationStatus:"start"}),o=[],i=0,n=Object.entries(t);i<n.length;i++)a=n[i],c=a[0],l=a[1],o.push(y.mergeDataFromStatsToReactionService(c,l,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId));return[4,Promise.all(o)];case 5:return p=r.sent(),[4,y.getItemsLoveData(this.items,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)];case 6:e=r.sent(),s.v.isSubset(t,e)?"function"==typeof this.reportMigratedLoveDataBiEvent&&this.reportMigratedLoveDataBiEvent({galleryId:this.galleryId,migrationStatus:"success"}):"function"==typeof this.Report&&((h=p.findIndex((function(e){return"200"!==e.status.toString()})))>-1?(d="Reaction-Service error - migrating data failed - ".concat(p[h].status," : ").concat(p[h].message),this.Report(d)):(d="Reaction-Service error - loveCountsReactionService !== loveCountsStatsApi",this.Report(d))),r.label=7;case 7:return[3,9];case 8:return r.sent(),"function"==typeof this.Report&&(d="Reaction-Service error - Migration general error",this.Report(d)),[3,9];case 9:return[2]}}))}))},e.prototype.getLoveDataUsingStatsApi=function(){return(0,r.sH)(this,void 0,void 0,(function(){var e,t,o;return(0,r.YH)(this,(function(r){switch(r.label){case 0:e="",r.label=1;case 1:return r.trys.push([1,5,,6]),(e=this.config.instanceId||l.A.instanceId)?[3,2]:(console.warn("cannot report love counter - no instance id"),[2]);case 2:return[4,f.get("".concat(this.baseUrl,"/pro-gallery-webapp/api/v1/gallery/").concat(this.galleryId,"/").concat(e,"/stats?cache_buster=").concat(Math.random()))];case 3:return(t=(t=r.sent()).data)&&t.photoId2Love?[2,t.photoId2Love]:[2];case 4:return[3,6];case 5:return o=r.sent(),console.error("Failed getting love counts",o),[3,6];case 6:return[2]}}))}))},e.prototype.getLoveDataWithOriginalFunction=function(){var e,t=this;try{e=this.config.instanceId||l.A.instanceId}catch(t){e=""}e?f.get("".concat(this.baseUrl,"/pro-gallery-webapp/api/v1/gallery/").concat(this.galleryId,"/").concat(e,"/stats?cache_buster=").concat(Math.random())).then((function(e){try{e&&e.data&&e.data.photoId2Love&&(t.loveCounts=e.data.photoId2Love,t.onLoveCountsFetched&&t.onLoveCountsFetched(t.loveCounts))}catch(e){console.error("Failed getting love counts",e)}})):console.warn("cannot report love counter - no instance id")},e.prototype.getLoveCount=function(e){return Math.max(0,this.loveCounts[e])||0},e.prototype.html2img=function(e,t){o.e(526).then(o.t.bind(o,2052,23)).then((function(o){try{var r=l.A.document.createElement("div");r.innerHTML=e.html,r.style.boxSizing="border-box",r.style.background=e.style.bgColor,r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.zIndex=-1,r.className="text-item",l.A.document.body.appendChild(r),o(r).then((function(e){r.remove();var o=e.toDataURL();"function"==typeof t&&t(o)}))}catch(e){"function"==typeof t&&t("")}}))},e.prototype.share=function(e,t,o){s.v.isDemo()||(o&&(t.numOfItems=o),this.shareImp(e,t))},e.prototype.downloadTextItem=function(e){this.html2img(e,(function(e){try{e=e.replace(/^data:image\/[^;]/,"data:application/octet-stream"),l.A.open(e)}catch(e){}}))},e.prototype.getReachLevel=function(e){var t,o=Number(e||0);if(n().isUndefined(this.reachLevel)){var r=s.v.getLocalStorage();t=Number(r["".concat(this.siteUrl,"|reach-level")]||0)+o}else t=this.reachLevel+o;return t},e.prototype.setReachLevel=function(e){e>0||(e=0);try{var t=this.getReachLevel(0);if(e>0&&0===t&&n().isUndefined(this.reachLevel))s.v.getLocalStorage()["".concat(this.siteUrl,"|reach-level")]=e,this.reachLevel=e}catch(e){console.warn("set reach level error",e)}},e.prototype.getShareUrl=function(e){var t=this.shouldUseGalleryIdForShareUrl?this.galleryId+"_":this.compId.replace("comp-","")+"-";return this.pageUrl+"?pgid="+t+this.getItemId(e)},e.prototype.getItemId=function(e){return e.id||e.photoId||e.itemId},e.prototype.shareImp=function(e,t,o){var r={id:this.getItemId(t),idx:t.idx||0,url:t.createUrl&&t.createUrl("sample","img"),title:t.title||t.description||this.siteInfo.siteTitle,hashtag:t.hashtag},i=encodeURIComponent(this.getShareUrl(r)),a=encodeURIComponent(r.title||""),c=encodeURIComponent(r.url),p=encodeURIComponent(this.siteInfo.siteKeywords),h=encodeURIComponent("".concat(this.getShareUrl(r)));switch(n().isFunction(o)||(o=function(e,t){try{if(s.v.isiOS()&&"Email"===t)l.A.location.href=e;else{var o=l.A.open(e,t+" Share","height=640,width=960,toolbar=no,menubar=no,scrollbars=no,location=no,status=no");setTimeout((function(){try{"Email"===t&&o.location.hasOwnProperty("pathname")&&"blank"===o.location.pathname&&o.close()}catch(e){console.warn("Could not close mailto window")}}),5e3)}}catch(e){}}),e){case"facebook":o("http://www.facebook.com/sharer/sharer.php?u="+i+"&t="+a,"Facebook");break;case"twitter":var d="&amp;text="+("undefined"===a?"":a);if(d.length>110)d=d.slice(0,107)+"...";else{var u="&amp;hashtags="+p;(d+u).length<=110&&(d+=u)}o("https://twitter.com/intent/tweet?url="+i+d,"Twitter");break;case"pinterest":o("https://pinterest.com/pin/create/button/?url="+i+"&media="+c.replace("webp","jpg")+"&description="+a,"Pinterest");break;case"google":o("https://plus.google.com/share?url="+i,"Google Plus");break;case"tumblr":o("http://www.tumblr.com/share/link?url="+i,"Tumblr");break;case"email":o("mailto:?Subject="+a+"&body="+h,"Email");break;case"copylink":!function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var o=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),o&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(o))}(this.getShareUrl(r))}},e.prototype.reportLoveToStats=function(e,t){try{if(!this.statsProps||!this.statsProps.instance_id)return void this.getStats();var o=n().merge(this.statsProps,{photo_id:e}),r=this.statsToken||l.A.statsToken,i=s.v.generateUUID();f.post(l.A.location.protocol+"//photographers-counters.wix.com/collector/rest/collect-js?ctToken="+r,JSON.stringify({messageId:i,metrics:[{type:"photo",reportMetrics:[{name:"love",value:String(t)}],properties:o}]}),{headers:{"Content-Type":"application/json"}}).then((function(e){console.log("Success report love",e)}))}catch(e){console.error("Error reporting love to stats",e)}},e.prototype.getLoveStorageKey=function(e){return"pro-gallery-item-love-"+e},e.prototype.isLoved=function(e){if(y.shouldUseReactionService()){var t=y.isLovedByCurrentVisitor(e,this.visitorId,this.reactionsServiceResponse),o=s.v.getLocalStorage()[this.getLoveStorageKey(e)];return t||o}try{return void 0!==s.v.getLocalStorage()&&(!!s.v.getLocalStorage()[this.getLoveStorageKey(e)]||!1)}catch(e){console.warn("isLoved failed",e)}},e.prototype.toggleLove=function(e,t){try{var o=this.isLoved(e)?"DELETE":"PUT";y.toggleItemLove(e,o,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)}catch(t){if(s.v.isVerbose()&&console.warn("Reaction service toggleLove failed",t),"function"==typeof this.Report){var r="Reaction Service error - couldn't toggle love data in gallery: ".concat(this.galleryId," item: ").concat(e);this.Report(r)}}if(!this.isRemoveUseOfCounterApiEnabled)try{if(!s.v.getLocalStorage())return!1;var i=void 0;this.isLoved(e)&&!0!==t||!1===t?(s.v.getLocalStorage()[this.getLoveStorageKey(e)]="",i=-1):(s.v.getLocalStorage()[this.getLoveStorageKey(e)]=!0,i=1),this.reportLoveToStats(e,i)}catch(e){console.warn("toggleLove failed",e)}},e.prototype.isFirstLoveClick=function(e){try{return void 0===s.v.getLocalStorage()[this.getLoveStorageKey(e)]}catch(e){console.warn("isFirstLoveClick failed",e)}},e.prototype.postLoveActivity=function(e){var t=this.getItemId(e);this.isFirstLoveClick(t)&&function(e){try{var t={type:a.A.Activities.Type.SOCIAL_TRACK,info:{type:e.activityType,channel:e.activityNetwork,itemInfo:{itemUrl:e.url,itemId:e.id,itemType:e.type.toUpperCase()}},details:{additionalInfoUrl:e.url,summary:""},contactUpdate:null};a.A.Activities.postActivity(t,(function(e){console.log("Activity ID: "+e.activityId+", Contact ID: "+e.contactId)}),(function(e){console.log("Failure message:",e)}))}catch(e){console.log("error posting activity.",e)}}({activityType:"LOVE",activityNetwork:"SITE",id:t,url:this.getShareUrl(e),type:e.type})},e.prototype.showTooltip=function(e,t,o){if(!(document.getElementsByClassName("pro-tooltip").length>=1)){var r=e.currentTarget;if(r){var i,n,s=r.getBoundingClientRect(),a=s.top,p=s.left;try{n=l.A.innerWidth}catch(e){n=980}switch(void 0===o&&(o=p>n/2?"right":"left"),o){case"top":i={top:a-30+"px",left:p+28+"px",opacity:1};break;case"right":i={top:a-4+"px",left:p-20+"px",opacity:1};break;default:i={top:a-4+"px",left:p+40+"px",opacity:1}}i["pointer-events"]="none";var h=l.A.document.createElement("div");h.classList.add("pro-tooltip"),h.classList.add(o),Object.assign(h.style,i),h.innerHTML=c.A.getByKey(t),l.A.document.body.appendChild(h)}}},e.prototype.hideTooltip=function(){l.A.document.body.removeChild(document.getElementsByClassName("pro-tooltip")[0])},e.prototype.toggleTooltip=function(e,t,o){1===document.getElementsByClassName("pro-tooltip").length?this.hideTooltip():this.showTooltip(e,t,o)},e.prototype.viewClassName=function(e,t){return"fullscreen"===e&&"desktop"===t?"fullscreen-icon":""},e}();const I=m;var S=new m}}]);
//# sourceMappingURL=ItemActions.chunk.min.js.map
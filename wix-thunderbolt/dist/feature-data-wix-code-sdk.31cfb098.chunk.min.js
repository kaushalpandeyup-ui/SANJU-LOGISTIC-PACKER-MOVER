(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[4600],{69012:e=>{var t=Object.prototype.toString;e.exports=function(e){var r=typeof e;return"undefined"===r?"undefined":null===e?"null":!0===e||!1===e||e instanceof Boolean?"boolean":"string"===r||e instanceof String?"string":"number"===r||e instanceof Number?"number":"function"===r||e instanceof Function?void 0!==e.constructor.name&&"Generator"===e.constructor.name.slice(0,9)?"generatorfunction":"function":void 0!==Array.isArray&&Array.isArray(e)?"array":e instanceof RegExp?"regexp":e instanceof Date?"date":"[object RegExp]"===(r=t.call(e))?"regexp":"[object Date]"===r?"date":"[object Arguments]"===r?"arguments":"[object Error]"===r?"error":"[object Promise]"===r?"promise":function(e){return e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}(e)?"buffer":"[object Set]"===r?"set":"[object WeakSet]"===r?"weakset":"[object Map]"===r?"map":"[object WeakMap]"===r?"weakmap":"[object Symbol]"===r?"symbol":"[object Map Iterator]"===r?"mapiterator":"[object Set Iterator]"===r?"setiterator":"[object String Iterator]"===r?"stringiterator":"[object Array Iterator]"===r?"arrayiterator":"[object Int8Array]"===r?"int8array":"[object Uint8Array]"===r?"uint8array":"[object Uint8ClampedArray]"===r?"uint8clampedarray":"[object Int16Array]"===r?"int16array":"[object Uint16Array]"===r?"uint16array":"[object Int32Array]"===r?"int32array":"[object Uint32Array]"===r?"uint32array":"[object Float32Array]"===r?"float32array":"[object Float64Array]"===r?"float64array":"object"}},86859:(e,t,r)=>{"use strict";function i(e){return"string"!=typeof e&&(e=JSON.stringify(e)),function(e){if(function(){try{return"8J+mhA=="===btoa("\u{1f984}")}catch(e){return!1}}())return btoa(e);return btoa(function(e){if("function"==typeof TextEncoder){const t=(new TextEncoder).encode(e);return Array.from(t,e=>String.fromCodePoint(e)).join("")}return e.replace(a,o)}(e))}(e).replace(/[+/]/g,e=>n[e]).replace(/={1,3}$/,"")}r.d(t,{A:()=>i});const n={"+":"-","/":"_"};const a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=e=>String.fromCharCode(e);function o(e){if(e.length<2){const t=e.charCodeAt(0);return t<128?e:t<2048?s(192|t>>>6)+s(128|63&t):s(224|t>>>12&15)+s(128|t>>>6&63)+s(128|63&t)}const t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return s(240|t>>>18&7)+s(128|t>>>12&63)+s(128|t>>>6&63)+s(128|63&t)}},59194:(e,t,r)=>{"use strict";r.d(t,{o:()=>n});var i=r(91139);function n(e){if(null==e||"object"!=typeof e)return e;let t=null;if((0,i.$P)(e))t=new Date(e.getTime());else{t=e.constructor();for(const r in e)t[r]=n(e[r])}return t}},91139:(e,t,r)=>{"use strict";r.d(t,{$P:()=>o,Et:()=>u,Gv:()=>a,Kg:()=>c,Lm:()=>l,Tn:()=>d,b0:()=>m,cy:()=>s,kK:()=>h,kZ:()=>p});var i=r(51361),n=r.n(i);function a(e){return"object"===n()(e)}function s(e){return"array"===n()(e)}function o(e){return"date"===n()(e)}function u(e){return"number"===n()(e)}function l(e){return"boolean"===n()(e)}function c(e){return"string"===n()(e)}function d(e){return"function"===n()(e)}function h(e){return function(e){if(!c(e))return e;const t=e.slice(0,1).toUpperCase(),r=e.slice(1,e.length);return t+r}(n()(e))}function m(e){return"undefined"===n()(e)}function p(e){return"null"===n()(e)}},11691:(e,t,r)=>{"use strict";function i(e){return e.reduce((e,t,r)=>{const[i,n]=Object.entries(t)[0];return"$match"===i&&0===r?{preFilteringStep:n}:"$match"===i?{...e,postFilteringStep:n}:"$group"===i?{...e,processingStep:n}:e},{})}r.d(t,{A:()=>i})},48699:(e,t,r)=>{"use strict";r.r(t),r.d(t,{base64url:()=>a.A,clone:()=>i.o,extractForwardHeaders:()=>d,getSchemaName:()=>l,getSchemaNamespace:()=>u,isArray:()=>n.cy,isBoolean:()=>n.Lm,isDate:()=>n.$P,isFunction:()=>n.Tn,isNull:()=>n.kZ,isNumber:()=>n.Et,isObject:()=>n.Gv,isString:()=>n.Kg,isUndefined:()=>n.b0,parseDates:()=>s.d,parseEntityJson:()=>s.$h,parseSchemaId:()=>c,serializeDates:()=>s.oq,stringifyEntityJson:()=>s.Dy,toPlatformizedAggregate:()=>o.A,typeForDisplay:()=>n.kK,validateHttpResponse:()=>h});var i=r(59194),n=r(91139),a=r(86859),s=r(7488),o=r(11691);function u(e){const t=e.lastIndexOf("/");return t>-1?e.substring(0,t):null}function l(e){const t=e.lastIndexOf("/");return t>-1?e.substring(t+1):e}function c(e){return{namespace:u(e),name:l(e)}}function d({headers:e={},query:t={}}){const r=["uuid","cid","authorization","wixsession2","cookie"],i=e=>0===e.indexOf("x-wix")||r.includes(e),n={};for(const t in e){const r=t.toLowerCase();e.hasOwnProperty(t)&&i(r)&&(n[r]=e[t])}const a="x-wix-request-id",s="request_id";return t&&t[s]&&(n[a]||(n[a]=t[s])),n}function h(e){if(e.status>=400){const t=JSON.stringify(e.data),r=new Error(`Request failed with status code ${e.status}. Data: '${t}'.`);throw r.response=e,r.config=e.config,r.request=e.request,r}return e}},7488:(e,t,r)=>{"use strict";function i(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}r.d(t,{$h:()=>a,Dy:()=>u,d:()=>s,oq:()=>o});const n=e=>isNaN(e)&&!isNaN(new Date(e).getDate());function a(e){let t=null;return JSON.parse(e,function(e,r){if("$date"===e&&n(r))t=new Date(r);else{if("$date"!==e){if(null!==t){const e=t;return t=null,e}return r}t={$date:r}}})}function s(e){if("object"!=typeof e||i(e))return e;const t=c(e);for(const e in t)t[e]&&t[e].$date&&n(t[e].$date)?t[e]=new Date(t[e].$date):"object"==typeof t[e]&&null!==t[e]&&(t[e]=s(t[e]));return t}function o(e){if("object"!=typeof e||i(e))return e;const t=c(e);for(const e in t)t[e]&&i(t[e])?t[e]=l(t[e]):"object"==typeof t[e]&&null!==t[e]&&(t[e]=o(t[e]));return t}function u(e){return JSON.stringify(e,function(e,t){return function(e,t,r){if(t&&i(e[t]))return l(e[t]);return r}(this,e,t)})}function l(e){return{$date:e.toJSON()}}function c(e){return Array.isArray(e)?Object.assign([],e):{...e}}},51361:e=>{var t=Object.prototype.toString;function r(e){return"function"==typeof e.constructor?e.constructor.name:null}e.exports=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var i=typeof e;if("boolean"===i)return"boolean";if("string"===i)return"string";if("number"===i)return"number";if("symbol"===i)return"symbol";if("function"===i)return"GeneratorFunction"===r(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){if(e.constructor&&"function"==typeof e.constructor.isBuffer)return e.constructor.isBuffer(e);return!1}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(r(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(i=t.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return i.slice(8,-1).toLowerCase().replace(/\s/g,"")}},37511:e=>{var t=Object.prototype.hasOwnProperty;function r(e){return"[Throws: "+(e?e.message:"?")+"]"}function i(e){var i=[];return function e(n){if(null===n||"object"!=typeof n)return n;if(-1!==i.indexOf(n))return"[Circular]";if(i.push(n),"function"==typeof n.toJSON)try{var a=e(n.toJSON());return i.pop(),a}catch(e){return r(e)}if(Array.isArray(n)){var s=n.map(e);return i.pop(),s}var o=Object.keys(n).reduce(function(i,a){return i[a]=e(function(e,i){if(t.call(e,i))try{return e[i]}catch(e){return r(e)}return e[i]}(n,a)),i},{});return i.pop(),o}(e)}e.exports=function(e,t,r){return JSON.stringify(i(e),t,r)},e.exports.ensureProperties=i},25721:(e,t,r)=>{"use strict";r.d(t,{DataSdkFactory:()=>kt});var i=r(59194),n=r(91139),a=r(37511),s=r.n(a);const o=()=>"WDE0001: Collection name must be a string.",u=()=>"WDE0002: ItemId must be a string.",l=()=>"WDE0068: Item ids must be an array of strings",c=e=>`WDE0069: Failed to remove items from [${e}].\nCannot remove more than 1000 items in one request`,d=()=>"WDE0003: FieldName must be a string.",h=(e,t)=>`WDE0004: Failed to save [${e}] into [${t}].\nItems must be JavaScript objects.`,m=e=>`WDE0005: Failed to bulk save items into [${e}].\nItems must be an array of JavaScript objects and itemIds must be strings if present.`,p=e=>`WDE0006: Failed to bulk save items into [${e}].\nCannot insert more than 1000 items in one request`,g=()=>"WDE0007: Invalid update. Updated object must have a string _id property.",f=(e,t,r,i)=>`WDE0008: wixData.${e} expects between ${t} and ${r} arguments, but was called with ${i}.`,v={aggregateInvalid:(e,t)=>`Failed to perform aggregation on [${e}].\n${t.join("\n")}`,filterMustBeBuilder:e=>`WDE0011: Invalid ${e} usage. ${e} requires WixDataFilter.`,filterIsAlreadySet:e=>`WDE0012: Invalid ${e} usage. Filter is already set.`,groupIsAlreadySet:e=>`WDE0013: Invalid ${e} usage. Group is already set.`},y=e=>`Failed to build a filter.\n${e.join("\n")}.`,N=e=>`Failed to build group.\n${e.join("\n")}.`,_=e=>`Failed to build a sort.\n${e.join("\n")}.`,I=e=>`WDE0018: Options must be an object with one or all of the following boolean properties: ${e.join(", ")}.`,A=()=>"WDE0019: Reference operation takes a string ID or an object with an ID to be connected.",b=()=>"WDE0021: Invalid reference",$={queryInvalid:(e,t)=>`Failed to perform query on [${e}].\n${t.join("\n")}`,isNumber:(e,t,r)=>`WDE0032: Invalid ${e} parameter [${(0,n.kK)(r)}]. ${e} parameter must be a ${t} number.`,isPositiveNumber:(e,t)=>`WDE0033: Invalid ${e} parameter [${t}]. ${e} parameter must be a positive number.`,isNonNegativeNumber:(e,t)=>`WDE0034: Invalid ${e} parameter [${t}]. ${e} parameter must be a non-negative number.`,isInteger:(e,t)=>`WDE0035: Invalid ${e} parameter [${t}]. ${e} parameter must be an integer.`,isNonEmptyString:e=>`WDE0094: Invalid ${e} parameter. ${e} parameter must be non-empty string.`,notGreaterThan:(e,t,r)=>`WDE0036: Invalid ${e} parameter [${t}]. ${e} parameter cannot exceed ${r}.`,invalidSkipParameter:(e,t)=>`WDE0037: Invalid query on [${e}].\nInvalid prev positioned query skip on a negative number ${t}.`,noPrevPage:e=>`WDE0159: Invalid query on [${e}].\nThere is no prev page.`,noNextPage:e=>`WDE0165: Invalid query on [${e}].\nThere is no next page.`},E={arityIsZero:e=>`WDE0038: Invalid ${e} usage. ${e} does not take parameters.`,arityIsOne:e=>`WDE0039: Invalid ${e} usage. ${e} requires one parameter.`,arityIsTwo:e=>`WDE0040: Invalid ${e} usage. ${e} requires two parameters.`,arityIsThree:e=>`WDE0041: Invalid ${e} usage. ${e} requires three parameters.`,arityIsAtLeastTwo:e=>`WDE0042: Invalid ${e} usage. ${e} requires at least two parameters.`,arityIsAtLeastOne:e=>`WDE0043: Invalid ${e} usage. ${e} requires at least one parameter.`},S={typeIsString:(e,t)=>`WDE0044: Invalid ${e} parameter value [${(0,n.kK)(t)}]. ${e} parameter must be a String.`,typeIsStringNumberOrDate:(e,t)=>`WDE0045: Invalid ${e} parameter value [${(0,n.kK)(t)}]. Valid ${e} parameter types are String, Number or Date.`,typeIsStringNumberBoolOrDate:(e,t)=>`WDE0045: Invalid ${e} parameter value [${(0,n.kK)(t)}]. Valid ${e} parameter types are String, Number, Boolean or Date.`,sameType:(e,t,r)=>`WDE0046: Invalid ${e} parameter values [${(0,n.kK)(t)}] and [${(0,n.kK)(r)}]. Both parameters must be of the same type.`,typeIsStringNumberOrDateForAll:e=>`WDE0047: Invalid ${e} usage. ${e} supports only Number, String or Date items.`,validFieldName:(e,t)=>`WDE0048: Invalid ${e} field value [${(0,n.kK)(t)}]. ${e} field must be a String.`,isInstanceOfSameClass:(e,t,r)=>`WDE0049: Invalid ${e} parameter [${(0,n.kK)(r)}]. ${e} expects ${t} only.`,isForCollection:(e,t,r)=>`WDE0050: Invalid ${e} parameter query for [${r}]. ${e} accepts ${t} for the same collection only.`},O={objectType:(e,t)=>`WDE0056: ${e} should be an Object. Got ${P(t)} instead`,arrayType:(e,t)=>`WDE0057: ${e} should be an Array. Got ${P(t)} instead`,arrayLength:(e,t,r)=>`WDE0057: ${P(r)}.length is ${r.length}. ${e} Array should have length ${t}`,comparisonOperatorType:(e,t)=>`WDE0058: ${e} should be a Date, Number, or String. Got ${P(t)} instead`,stringOperatorType:(e,t)=>`WDE0059: ${e} should be a String. Got ${P(t)} instead`,setOperatorItems:(e,t)=>`WDE0060: ${e} Array should only contain values of types Date, Number, and String. Got ${P(t)} instead`,inOperatorItems:e=>`WDE0061: $in Array should have length 2, and match [String, Number]. Got ${P(e)} instead`,matchesOperatorRequiredProperty:(e,t)=>`WDE0062: $matches value ${P(t)} does not have property ${e}`,matchesOperatorIgnoreCase:e=>`WDE0063: $matches.ignoreCase should equal true. Got ${P(e)} instead`,matchesOperatorSpecItems:e=>`WDE0064: $matches.spec Array values should be either {"type":"anyOf","value":" -"} or {"type":"literal","value":String}. Got ${P(e)} instead`,regexNotAllowed:()=>"WDE0070: $regex keyword is not allowed."},D={typeIsStringOrArrayOfStrings:(e,t)=>`WDE0051: Invalid ${e} parameters [${t.map(n.kK)}]. Valid ${e} values are String, Array of String or varargs String.`},C={sortModelType:e=>`WDE0065: Sort Model should be an Array. Got ${P(e)} instead`,sortModelItemType:e=>`WDE0066: Sort Model Array should contain values of type Object only. Got ${P(e)} instead`,sortModelItem:e=>`WDE0067: Sort Model Array items should have a single property with value "asc" or "desc". Got ${P(e)} instead`},T=e=>"WDE0055: Failed to parse server response."+(e?` ${e}`:""),j=()=>"WDE0080: Skip is not supported in cursor paging.",w=()=>"WDE0109: Payload is too large.";function P(e){return s()(e)}const k="WD_ITEM_DOES_NOT_EXIST",x="WD_ITEM_ALREADY_EXISTS",R="WD_SITE_IN_TEMPLATE_MODE",W="WD_UNKNOWN_ERROR",F="WD_VALIDATION_ERROR",V="WD_COLLECTION_DELETED",B="WD_SCHEMA_DOES_NOT_EXIST",M="WD_PERMISSION_DENIED";function q(e,t,r){return z(e,t,r)}function U(e){return z(e,F)}function z(e,t,r){const i=new(t&&t!==W?L:Error)(e);return t&&(i.code=t),r&&(i.details=r),i}class L extends Error{constructor(e){super(e),this.name="Error",this.errorGroup="User",Error.captureStackTrace&&Error.captureStackTrace(this,L)}}class K extends Error{constructor(e,t,r,i,n){super(e),this.message=e,this.code=t,this.item=r,this.name=i,this.originalIndex=n,Error.captureStackTrace&&Error.captureStackTrace(this,K)}}class G{constructor(){this._validations=[]}arityIsZero(e){return this.addValidation(()=>0===e.length,()=>E.arityIsZero(this.operatorName??""))}arityIsOne(e){return this.addValidation(()=>1===e.length,()=>E.arityIsOne(this.operatorName??""))}arityIsTwo(e){return this.addValidation(()=>2===e.length,()=>E.arityIsTwo(this.operatorName??""))}arityIsThree(e){return this.addValidation(()=>3===e.length,()=>E.arityIsThree(this.operatorName??""))}arityIsAtLeastTwo(e){return this.addValidation(()=>e.length>=2,()=>E.arityIsAtLeastTwo(this.operatorName??""))}arityIsAtLeastOne(e){return this.addValidation(()=>e.length>=1,()=>E.arityIsAtLeastOne(this.operatorName??""))}addValidation(e,t){return this._validations.push({predicateFn:e,messageFn:t}),this}}class H extends G{constructor(e){super(),this._invalidArguments=(0,i.o)(e)}validateAndAggregate(){const e=this._validations.every(({predicateFn:e,messageFn:t})=>this._appendIfInvalid(e(),t()));return[this._invalidArguments,e]}_appendIfInvalid(e,t){return!!e||(this._invalidArguments.push(t),!1)}}class Q extends G{constructor(e=U){super(),this.buildError=e}validateAndReject(){return Promise.resolve().then(()=>{this._validations.forEach(({predicateFn:e,messageFn:t})=>{if(!e())throw this.buildError(t())})})}validateAndReturn(){const e=[];return this._validations.forEach(({predicateFn:t,messageFn:r})=>{t()||e.push(r())}),e}}class J extends Q{arity(e,t,r,i){return this.addValidation(()=>t.length<=i&&t.length>=r,()=>f(e,r,i,t.length))}_isObject(e,t){return this.addValidation(()=>(0,n.Gv)(e),()=>h(e,t))}item(e,t,r){return this._isObject(e,t).addValidation(()=>void 0!==e._id?(0,n.Kg)(e._id):!r,()=>g())}items(e,t){return this.addValidation(()=>(0,n.cy)(e)&&e.every(e=>(0,n.Gv)(e)&&(void 0===e._id||null===e._id||(0,n.Kg)(e._id))),()=>m(t)).addValidation(()=>e.length<=1e3,()=>p(t))}fieldName(e){return this.addValidation(()=>(0,n.Kg)(e),()=>d())}itemId(e){return this.addValidation(()=>(0,n.Kg)(e),()=>u())}itemIds(e,t){return this.addValidation(()=>(0,n.cy)(e)&&e.every(e=>(0,n.Kg)(e)),()=>l()).addValidation(()=>e.length<=1e3,()=>c(t))}_options(e,t){return this.addValidation(()=>{const r=(0,n.Gv)(e)&&t.every(t=>{return"language"===t?null==(r=e[t])||(0,n.Kg)(r)&&r.length>0:function(e){return null==e||(0,n.Lm)(e)}(e[t]);var r});return null==e||r},()=>I(t))}referenceRemoveParameters(e){return this.addValidation(()=>(0,n.cy)(e)&&e.every(Z),A)}referenceParameters(e){return this.addValidation(()=>(0,n.cy)(e)&&e.every(Y),A)}referenceParameter(e){return this.addValidation(()=>Y(e),A)}isNonEmptyString(e,t){return this.addValidation(()=>"string"==typeof e&&e.length>0,()=>$.isNonEmptyString(t))}references(e){return this.addValidation(()=>(0,n.cy)(e)&&e.every(e=>(0,n.Kg)(e.relationshipName)&&Y(e.left)&&Y(e.right)),b)}options(e){return this._options(e,["suppressAuth","suppressHooks","showDrafts","consistentRead","language"])}bulkInsertOptions(e){return this._options(e,["suppressAuth","suppressHooks","overrideExisting"])}bulkUpdateOptions(e){return this._options(e,["suppressAuth","suppressHooks","showDrafts"])}bulkRemoveOptions(e){return this._options(e,["suppressAuth","suppressHooks","showDrafts"])}truncateOptions(e){return this._options(e,["suppressAuth"])}collectionName(e){return this.addValidation(()=>(0,n.Kg)(e),()=>o())}}function X(e){return new J(e)}function Y(e){return(0,n.Kg)(e)&&""!==e||(0,n.Gv)(e)&&e.hasOwnProperty("_id")}function Z(e){return(0,n.Kg)(e)||(0,n.Gv)(e)&&e.hasOwnProperty("_id")}var ee=r(69012),te=r.n(ee);function re(e){return"array"===te()(e)}function ie(e){return"date"===te()(e)}function ne(e){return"number"===te()(e)}function ae(e){return"string"===te()(e)}function se(e){return function(e){if(!ae(e))return e;const t=e.slice(0,1).toUpperCase(),r=e.slice(1,e.length);return t+r}(te()(e))}function oe(e){if(null==e||"object"!=typeof e)return e;let t=null;if(ie(e))t=new Date(e.getTime());else{t=e.constructor();for(const r in e)t[r]=oe(e[r])}return t}class ue{constructor(e,t,r){this._validations=[],this.operatorName=e,this.ctor=r,this._invalidArguments=oe(t)}typeIsString(e){return this.addValidation(()=>ae(e),()=>`Invalid ${this.operatorName} parameter value [${se(e)}]. ${this.operatorName} parameter must be a String.`)}typeIsStringNumberOrDate(e){return this.addValidation(()=>le(e),()=>`Invalid ${this.operatorName} parameter value [${se(e)}]. Valid ${this.operatorName} parameter types are String, Number or Date.`)}typeIsStringNumberBoolOrDate(e){return this.addValidation(()=>function(e){return ae(e)||ne(e)||ie(e)||(t=e,"boolean"===te()(t));var t}(e),()=>`Invalid ${this.operatorName} parameter value [${se(e)}]. Valid ${this.operatorName} parameter types are String, Number, Boolean or Date.`)}sameType(e,t){return this.addValidation(()=>se(e)===se(t),()=>`Invalid ${this.operatorName} parameter values [${se(e)}] and [${se(t)}]. Both parameters must be of the same type.`)}typeIsStringNumberOrDateForAll(e){return this.addValidation(()=>e.every(le),()=>`Invalid ${this.operatorName} usage. ${this.operatorName} supports only Number, String or Date items.`)}validFieldName(e){return this.addValidation(()=>ae(e),()=>`Invalid ${this.operatorName} field value [${se(e)}]. ${this.operatorName} field must be a String.`)}isInstanceOfSameClass(e){return this.addValidation(()=>e instanceof this.ctor,()=>`Invalid ${this.operatorName} parameter [${se(e)}]. ${this.operatorName} expects FilterBuilder only.`)}arityIsOne(e){return this.addValidation(()=>1===e.length,()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires one parameter.`)}arityIsTwo(e){return this.addValidation(()=>2===e.length,()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires two parameters.`)}arityIsThree(e){return this.addValidation(()=>3===e.length,()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires three parameters.`)}arityIsAtLeastTwo(e){return this.addValidation(()=>e.length>=2,()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires at least two parameters.`)}addValidation(e,t){return this._validations.push({predicateFn:e,messageFn:t}),this}validateAndAggregate(){const e=this._validations.every(({predicateFn:e,messageFn:t})=>this._appendIfInvalid(e(),t()));return[this._invalidArguments,e]}_appendIfInvalid(e,t){return!!e||(this._invalidArguments.push(t),!1)}}function le(e){return ae(e)||ne(e)||ie(e)}const ce=[function(e){const t=e.$and;if(Array.isArray(t)&&1===t.length)return t[0]},function(e){const t=e.$and;if(Array.isArray(t)&&0===t.length)return{};return null},function(e){const t=e.$and;if(!t)return;let r=[],i=[];if(t.forEach(e=>{!function(e){const t=Object.keys(e);return t.every(e=>e.startsWith("$"))&&t.length>0}(e)?r=[...r,e]:i=[...i,e]}),r.length<=1||function(e){const t=e.map(e=>Object.keys(e)).reduce((e,t)=>[...e,...t],[]);return function(e){const t={};return e.forEach(e=>t[e]=!0),Object.keys(t)}(t).length!==t.length}(r))return;return{$and:[Object.assign({},...r),...i]}},function(e){const t=e.$and;if(!t)return;if(!t.find(e=>e.$and))return;return{$and:t.reduce((e,t)=>{const r=t.$and;return r?[...e,...r]:[...e,t]},[])}},function(e){const t=e.$or;if(!t)return;if(!t.find(e=>e.$or))return;return{$or:t.reduce((e,t)=>{const r=t.$or;return r?[...e,...r]:[...e,t]},[])}}];function de(e){const[t]=he(e);return t}function he(e){return Array.isArray(e)?function(e){const t=e.map(he),r=0<t.filter(([,e])=>e).length;return[t.map(([e])=>e),r]}(e):"object"!=typeof e||null===e||e instanceof Date?[e,!1]:function(e){const[t,r]=s(e),[i,n]=a(t);return[i,r||n];function a(e){const t=function(e){for(const t of ce){const r=t(e);if(r)return r}}(e);if(!t)return[e,!1];const[r]=he(t);return[r,!0]}function s(e){const t=Object.entries(e).map(o).filter(([,,e])=>e);return[{...e,...u(t)},!!t.length]}function o([e,t]){const[r,i]=he(t);return[e,r,i]}function u(e){return e.reduce((e,[t,r])=>({...e,[t]:r}),{})}}(e)}function me(...e){return{$and:e}}function pe(e){return e&&e.$and&&0===e.$and.length}const ge=(e=class{})=>class extends e{constructor(e={}){super(e),this.filterTree=e.filterTree||{$and:[]},this.invalidArguments=e.invalidArguments||[],this.encoder=e.encoder||{}}eq(...e){return this._binaryAnd("$eq",".eq",e)}ne(...e){return this._binaryAnd("$ne",".ne",e)}ge(...e){return this._AndLogicalEquivalence("$gte",".ge",e)}gt(...e){return this._AndLogicalEquivalence("$gt",".gt",e)}le(...e){return this._AndLogicalEquivalence("$lte",".le",e)}lt(...e){return this._AndLogicalEquivalence("$lt",".lt",e)}isNotEmpty(e){const[t,r]=this._filterValidator(".isNotEmpty").arityIsOne(arguments).validFieldName(e).validateAndAggregate();return r?this.ne(e,null):this._copy(this.filterTree,t)}isEmpty(e){const[t,r]=this._filterValidator(".isEmpty").arityIsOne(arguments).validFieldName(e).validateAndAggregate();return r?this.eq(e,null):this._copy(this.filterTree,t)}startsWith(...e){return this._AndStringOperand("$startsWith",".startsWith",e)}endsWith(...e){return this._AndStringOperand("$endsWith",".endsWith",e)}contains(...e){return this._AndStringOperand("$contains",".contains",e)}hasSome(...e){return this._AndSetOperand("$hasSome",".hasSome",e)}hasAll(...e){return this._AndSetOperand("$hasAll",".hasAll",e)}or(e){const[t,r]=this._filterValidator(".or").arityIsOne(arguments).isInstanceOfSameClass(e).validateAndAggregate();if(r){const r=pe(this.filterTree)?[]:[this.filterTree];return this._copy(me({$or:[...r,e.filterTree]}),t.concat(e.invalidArguments))}return this._copy(this.filterTree,t)}and(e){const[t,r]=this._filterValidator(".and").arityIsOne(arguments).isInstanceOfSameClass(e).validateAndAggregate();if(r){const r=pe(this.filterTree)?[]:[this.filterTree];return this._copy(me(...r,e.filterTree),t.concat(e.invalidArguments))}return this._copy(this.filterTree,t)}not(e){const[t,r]=this._filterValidator(".not").arityIsOne(arguments).isInstanceOfSameClass(e).validateAndAggregate();if(r){const r=function(...e){return{$and:e.reduce((e,t)=>re(t.$and)?e.concat(t.$and):e.concat([t]),[])}}(oe(this.filterTree),{$not:[e.filterTree]});return this._copy(r,t.concat(e.invalidArguments))}return this._copy(this.filterTree,t)}between(e,t,r){const[i,n]=this._filterValidator(".between").arityIsThree(arguments).sameType(t,r).typeIsStringNumberOrDate(t).typeIsStringNumberOrDate(r).validateAndAggregate();return n?this.ge(e,t).lt(e,r):this._copy(this.filterTree,i)}getFilterModel(){if(this.invalidArguments.length>0)throw new Error(this.invalidArguments.join(" "));return de(this.filterTree)}setFilterModel(e){return this._copy(e,[])}_binaryAnd(e,t,r){const[i,n]=Array.prototype.slice.call(r),[a]=this._filterValidator(t).arityIsTwo(r).validFieldName(i).validateAndAggregate(),s=this._makeNewFilter(i,e,n);return this._copy(s,a)}_AndLogicalEquivalence(e,t,r){const[i,n]=Array.prototype.slice.call(r),[a]=this._filterValidator(t).arityIsTwo(r).validFieldName(i).typeIsStringNumberBoolOrDate(n).validateAndAggregate(),s=this._makeNewFilter(i,e,n);return this._copy(s,a)}_AndStringOperand(e,t,r){const[i,n]=Array.prototype.slice.call(r),[a]=this._filterValidator(t).arityIsTwo(r).validFieldName(i).typeIsString(n).validateAndAggregate(),s=this._makeNewFilter(i,e,n);return this._copy(s,a)}_AndSetOperand(e,t,r){const[i,...n]=Array.prototype.slice.call(r),a=re(n[0])?n[0]:n,[s]=this._filterValidator(t).arityIsAtLeastTwo(r).validFieldName(i).typeIsStringNumberOrDateForAll(a).validateAndAggregate(),o=this._makeNewFilter(i,e,a);return this._copy(o,s)}_makeNewFilter(e,t,r){const i=oe(this.filterTree),n=void 0===r?null:r,a=this._buildFilter(e,t,n);if(re(i.$and))return i.$and.push(a),i;return s=i,0===Object.keys(s).length?me(a):me(i,a);var s}_buildFilter(e,t,r){if("$eq"!==t){const i={};return i[e]={},i[e][t]=this._encode(r),i}{const t={};return t[e]=this._encode(r),t}}_encode(e){return t=this.encoder,"function"===te()(t)?this.encoder(e):e;var t}_copy(e,t){return new this.constructor({...this,filterTree:e,invalidArguments:t})}_filterValidator(e){return new ue(e,this.invalidArguments,this.constructor)}};class fe extends(ge()){get constructorName(){return"FilterBuilder"}_build(){return this.getFilterModel()}}function ve(e={}){return new fe(e)}const ye=ve;function Ne(e){const t=e.split("-"),r=[];for(let e=0;e<t.length-1;e++)i(r,t[e]),n(r);return i(r,t[t.length-1]),r;function i(e,t){0!==t.length&&e.push({type:"literal",value:t})}function n(e){e.push({type:"anyOf",value:" \t\n-"})}}class _e extends H{constructor(e,t,r,i){super(t),this.operatorName=e,this.ctor=r,this.constructorName=i}typeIsString(e){return this.addValidation(()=>(0,n.Kg)(e),()=>S.typeIsString(this.operatorName,e))}typeIsStringNumberOrDate(e){return this.addValidation(()=>Ie(e),()=>S.typeIsStringNumberOrDate(this.operatorName,e))}typeIsStringNumberBoolOrDate(e){return this.addValidation(()=>function(e){return(0,n.Kg)(e)||(0,n.Et)(e)||(0,n.$P)(e)||(0,n.Lm)(e)}(e),()=>S.typeIsStringNumberBoolOrDate(this.operatorName,e))}sameType(e,t){return this.addValidation(()=>(0,n.kK)(e)===(0,n.kK)(t),()=>S.sameType(this.operatorName,e,t))}typeIsStringNumberOrDateForAll(e){return this.addValidation(()=>e.every(Ie),()=>S.typeIsStringNumberOrDateForAll(this.operatorName))}validFieldName(e){return this.addValidation(()=>(0,n.Kg)(e),()=>S.validFieldName(this.operatorName,e))}isInstanceOfSameClass(e){return this.addValidation(()=>e instanceof this.ctor,()=>S.isInstanceOfSameClass(this.operatorName,this.constructorName,e))}isForCollection(e,t){return this.addValidation(()=>e.collectionName===t,()=>S.isForCollection(this.operatorName,this.constructorName,e.collectionName))}}function Ie(e){return(0,n.Kg)(e)||(0,n.Et)(e)||(0,n.$P)(e)}const Ae=(e=class{})=>class extends(ge(e)){constructor(e){super(e),this.validateCollectionName=e?.validateCollectionName??!0}or(e){const t=super.or.apply(this,arguments);return this._validateCollectionName(t,e,".or")}and(e){const t=super.and.apply(this,arguments);return this._validateCollectionName(t,e,".and")}not(e){const t=super.not.apply(this,arguments);return this._validateCollectionName(t,e,".not")}_validateCollectionName(e,t,r){if(e.invalidArguments.length>0||!this.validateCollectionName)return e;const i=function(e,t){if(!e||!e.constructor)return e;const r=e.collectionName?e.collectionName:t;return new e.constructor({...e,collectionName:r})}(t,this.collectionName),[n,a]=new _e(r,e.invalidArguments,this.constructor,this.constructorName??this.constructor.name).isForCollection(i,this.collectionName).validateAndAggregate();return a?e:this._copy(this.filterTree,n)}_matchesUrlized(e,t){const[r,i]=this._filterValidator("._matchesUrlized").arityIsTwo(arguments).validFieldName(e).typeIsString(t).validateAndAggregate();if(i){const i=this._makeNewFilter(e,...function(e){return t(e)?["$in",[e,Number.parseInt(e)]]:["$matches",{ignoreCase:!0,spec:Ne(e)}];function t(e){return/^-?[0-9]{1,16}$/.test(e)}}(t));return this._copy(i,r)}return this._copy(this.filterTree,r)}getFilterModel(){if(this.invalidArguments.length>0)throw U(y(this.invalidArguments));return super.getFilterModel()}_filterValidator(e){return new _e(e,this.invalidArguments,this.constructor,this.constructorName??this.constructor.name)}},be=(e=class{})=>class extends e{constructor(e={}){super(e),this.orderBy=e.orderBy||[],this.invalidArguments=e.invalidArguments||[]}ascending(...e){return this._sortClause("asc",".ascending",e)}descending(...e){return this._sortClause("desc",".descending",e)}getSortModel(){if(this.invalidArguments.length>0)throw U(_(this.invalidArguments));return this.orderBy}setSortModel(e){return this._copySort(e,[])}_sortClause(e,t,r){let a=[];this.orderBy&&(a=(0,i.o)(this.orderBy));const s=(o=a,u=e,e=>{const t={[e]:u};o.push(t)});var o,u;const l=(0,n.cy)(r[0])&&1===r.length?r[0]:Array.prototype.slice.call(r,0),[c,d]=this._sortValidator(t).arityIsAtLeastOne(r).allStrings(l).validateAndAggregate();return d&&l.forEach(s),this._copySort(a,c)}_sortValidator(e){return new $e(e,this.invalidArguments)}_copySort(e,t){return new this.constructor({...this,orderBy:e,invalidArguments:t})}};class $e extends H{constructor(e,t){super(t),this.operatorName=e}allStrings(e){return this.addValidation(()=>e.every(n.Kg),()=>D.typeIsStringOrArrayOfStrings(this.operatorName,e))}}be();const Ee=be,Se=9007199254740991;class Oe extends H{constructor(e,t){super(t),this.operatorName=e}_isNumber(e,t){return this.addValidation(()=>(0,n.Et)(t),()=>$.isNumber(this.operatorName,e,t))}isPositiveNumber(e){return this._isNumber("positive",e).addValidation(()=>!Number.isNaN(e)&&e>0,()=>$.isPositiveNumber(this.operatorName,e))}isNonNegativeNumber(e){return this._isNumber("non-negative",e).addValidation(()=>!Number.isNaN(e)&&e>=0,()=>$.isNonNegativeNumber(this.operatorName,e))}isInteger(e){return this.addValidation(()=>!Number.isNaN(e)&&Number.isFinite(e)&&Number.isInteger(e)&&e<Se&&e>-9007199254740991,()=>$.isInteger(this.operatorName,e))}isOptionalInteger(e){return void 0===e?this:this.isInteger(e)}notGreaterThan(e,t){return this.addValidation(()=>e<=t,()=>$.notGreaterThan(this.operatorName,e,t))}nonEmptyString(e){return this.addValidation(()=>"string"==typeof e&&e.length>0,()=>$.isNonEmptyString(this.operatorName))}}function De(e){return"string"==typeof e&&e.length>0}class Ce extends(Ae(Ee())){constructor(e){super(e),this.provider=e.provider,this.collectionName=e.collectionName,this.limitNumber=e.limitNumber,this.invalidArguments=e.invalidArguments,this.orderBy=e.orderBy,this.randomSortOptions=e.randomSortOptions,this.skipNumber=e.skipNumber,this.included=e.included,this.projectedFields=e.projectedFields,this.cursor=e.cursor}get constructorName(){return"WixDataQuery"}count(e){return Te(this.invalidArguments,this.collectionName).then(()=>X().options(e).validateAndReject()).then(()=>this.provider.count(this.collectionName,this.getOptimizedFilter(),e)).then(e=>e.totalCount)}distinct(e,t){const r=r=>{const i=r.cursor?void 0:r.skipNumber,n=r.cursor?"":e,a=!!r.cursor||(t||{}).omitTotalCount;return r.provider.distinct(r.collectionName,r.getOptimizedFilter(),r.orderBy,n,i,r.limitNumber,t,r.cursor,void 0,a)};return Te(this.invalidArguments,this.collectionName).then(()=>X().options(t).validateAndReject()).then(()=>X().fieldName(e).validateAndReject()).then(()=>r(this)).then(e=>new we({result:e,query:this,pagingFunction:r}))}_transformOrderingForAggregates(e=[],t){return e.length>0?e.filter(e=>e.hasOwnProperty(t)).map(e=>({_id:e[t]})):null}_distinctValuesPipeline(e){return[this.filterTree&&Object.keys(this.filterTree).length>0?{$match:this.filterTree}:null,{$distinct:`$${e}`}].filter(this._stageFilter)}_stageFilter(e){return null!==e}fields(...e){const t=(0,i.o)(this.projectedFields);for(let r=0;r<e.length;r++)t.push(e[r]);return this.copy({projectedFields:t})}find(e){const t=t=>{const r=t.cursor?void 0:t.skipNumber,i=!!t.cursor||e?.omitTotalCount;return t.provider.find(t.collectionName,t.getOptimizedFilter(),t.orderBy,r,t.limitNumber,e,t.included,i,t.cursor,t.projectedFields,t.randomSortOptions)};return Te(this.invalidArguments,this.collectionName).then(()=>X().options(e).validateAndReject()).then(()=>t(this)).then(e=>new we({result:e,query:this,pagingFunction:t}))}limit(e){const[t]=this._queryValidator(".limit").arityIsOne(arguments).isPositiveNumber(e).isInteger(e).validateAndAggregate();return this.copy({limitNumber:e,invalidArguments:t})}skip(e){const[t]=this._queryValidator(".skip").arityIsOne(arguments).isNonNegativeNumber(e).isInteger(e).validateAndAggregate();return this.copy({skipNumber:e,invalidArguments:t})}include(...e){const t=(0,i.o)(this.included);for(let r=0;r<e.length;r++)t.push(e[r]);return this.copy({included:t})}setFilterModel(e){const t=super.setFilterModel(e);return this._setQuerySpecificInvalidArguments(t)}getOptimizedFilter(){try{return de(this.filterTree)}catch(e){return this.filterTree}}setSortModel(e){const t=super.setSortModel(e);return this._setQuerySpecificInvalidArguments(t)}_setQuerySpecificInvalidArguments(e){const t=(e,t)=>void 0!==e?t.validateAndAggregate()[0]:[],r=this._queryValidator(".limit",[]).isPositiveNumber(this.limitNumber).isInteger(this.limitNumber),i=this._queryValidator(".skip",[]).isNonNegativeNumber(this.skipNumber).isInteger(this.skipNumber),n=[...t(this.limitNumber,r),...t(this.skipNumber,i)];return Object.assign(e,{invalidArguments:n})}randomSort(e){const t=[];if(void 0!==e&&"object"!=typeof e){const i=(r=e,Object.prototype.toString.call(r).slice(8,-1));t.push(`WDE0051: Invalid .randomSort parameters [${i}]. Valid .randomSort expects an object with optional "seed" number.`)}var r;const i=void 0!==e?.seed?e:{};return this.copy({randomSortOptions:i,invalidArguments:(this.invalidArguments||[]).concat(t)})}_queryValidator(e,t=this.invalidArguments){return new Oe(e,t)}copy(e={}){return new Ce({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:this.limitNumber,invalidArguments:this.invalidArguments,included:this.included,cursor:this.cursor,projectedFields:this.projectedFields,randomSortOptions:this.randomSortOptions,...e})}}function Te(e,t){const r=((0,n.Kg)(t)?[]:[o()]).concat(e);return r.length>0?Promise.reject(U($.queryInvalid(t,r))):Promise.resolve()}function je(e,t){return new Ce({provider:e,collectionName:t,filterTree:{},orderBy:void 0,skipNumber:0,invalidArguments:[],included:[],projectedFields:[]})}class we{constructor(e){if(this._isCreatedByCursor=!1,this._offset=0,this._executeQuery=(e,t)=>{const r=De(e)?this._getNewCursorQuery(e,t):this._getNewQuery(t);return this._pagingFunction(r).then(e=>new we({result:e,lastResult:this,isNext:t,query:r,pagingFunction:this._pagingFunction}))},!e)return;const t=e.result,r=e.result.pagingMetadata??{},i=e.lastResult;this._items=t.items,this._cursors=r.cursors,this._isCreatedByCursor=De(e.query.cursor),this._query=e.query,this._partialIncludes=t.partialIncludes,this._pagingFunction=e.pagingFunction,this._hasNext=t.pagingMetadata?.hasNext||!1,this._totalCount=this._isCreatedByCursor?i?.totalCount:t.totalCount,e.query.limitNumber?this._effectivePageSize=e.query.limitNumber:i?._effectivePageSize?this._effectivePageSize=i._effectivePageSize:!this._hasNext&&r.cursors||(this._effectivePageSize=t.items.length),void 0!==e.query.skipNumber?this._offset=e.query.skipNumber:this._isCreatedByCursor&&this._effectivePageSize>0&&i&&(this._offset=e.isNext?i._offset+this._effectivePageSize:Math.max(0,i._offset-this._effectivePageSize))}get items(){return this._items}get length(){return this.items.length}get totalCount(){return this._totalCount}get query(){return this._query}get pageSize(){return this._query.limitNumber}get totalPages(){return 0===this.totalCount?0:this._effectivePageSize>0&&this.totalCount>0?Math.ceil(this.totalCount/this._effectivePageSize):0===this._offset&&!this.hasNext()&&this.totalCount>0?1:void 0}get currentPage(){if(0!==this.length)return this._effectivePageSize>0&&void 0!==this._offset?Math.ceil(this._offset/this._effectivePageSize):0===this._offset&&!this.hasNext()&&this.totalCount>0?0:void 0}get partialIncludes(){return this._partialIncludes}next(){return this.hasNext()?this._executeQuery(this.nextCursor,!0):this._rejectNoNextPage()}prev(){return this.hasPrev()?this._executeQuery(this.prevCursor,!1):this._rejectNoPrevPage()}get nextCursor(){return this._cursors&&this._cursors.next}get prevCursor(){return this._cursors&&this._cursors.prev}hasNext(){return this._hasNext}hasPrev(){return this._isCreatedByCursor||this._cursors?De(this.prevCursor):this.currentPage>0}toJSON(){return{currentPage:this.currentPage,items:this.items,length:this.length,pageSize:this.pageSize,partialIncludes:this.partialIncludes,query:this.query,totalCount:this.totalCount,totalPages:this.totalPages}}_getNewQuery(e){return this.query.copy({skipNumber:e?this._nextOffset():this._prevOffset(),limitNumber:this._effectivePageSize,invalidArguments:[]})}_getNewCursorQuery(e,t){return this.query.copy({skipNumber:t?this._nextOffset():this._prevOffset(),filterTree:{},orderBy:void 0,cursor:e,invalidArguments:[]})}_nextOffset(){if(this._effectivePageSize)return this._offset+this._effectivePageSize}_prevOffset(){if(this._effectivePageSize)return Math.max(this._offset-this._effectivePageSize,0)}_rejectNoPrevPage(){return Promise.reject(U($.noPrevPage(this.query.collectionName)))}_rejectNoNextPage(){return Promise.reject(U($.noNextPage(this.query.collectionName)))}get nextSkipNumber(){return this._nextOffset()}get prevSkipNumber(){return this._prevOffset()}}const Pe=(e=class{})=>class extends e{constructor(e={}){super(e),this.groupByTree=e.groupByTree,this.invalidArguments=e.invalidArguments||[]}sum(e,t){const[r]=this._groupValidator(".sum").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("sum",e,t,r)}avg(e,t){const[r]=this._groupValidator(".avg").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("avg",e,t,r)}min(e,t){const[r]=this._groupValidator(".min").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("min",e,t,r)}max(e,t){const[r]=this._groupValidator(".max").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("max",e,t,r)}count(){const[e]=this._groupValidator(".count").arityIsZero(arguments).validateAndAggregate(),t=(0,i.o)(this.groupByTree)||{_id:We()};return t.count={$sum:1},this._copy(t,e)}_addAccumulator(e,t,r,n){const a=(0,i.o)(this.groupByTree)||{_id:We()},s=r||t+((o=e).charAt(0).toUpperCase()+o.slice(1));var o;const u={};return u[`$${e}`]=`$${t}`,a[s]=u,this._copy(a,n)}_copy(e,t){return new this.constructor({...this,groupByTree:e,invalidArguments:t})}_groupValidator(e){return new xe(e,this.invalidArguments)}};class ke extends(Pe()){_build(){return function(e){if(e.length>0)throw U(N(e))}(this.invalidArguments),this.groupByTree}}class xe extends H{constructor(e,t){super(t),this.operatorName=e}typeIsString(e){return this.addValidation(()=>(0,n.Kg)(e),()=>S.typeIsString(this.operatorName,e))}}function Re(...e){const t=We(...e);return new ke({groupByTree:{_id:t}})}function We(...e){if(1===e.length)return`$${e}`;if(e.length>1){const t={};return e.forEach(e=>t[e]=`$${e}`),t}return"0"}function Fe(e,t,r){const i=e.skipNumber||0;let n=void 0===e.limitNumber?t:e.limitNumber;return r&&(n=Math.min(n,t)),r?i+n:i-n}class Ve extends(Ee(Pe())){constructor(e={}){super(e),this.provider=e.provider,this.collectionName=e.collectionName,this.filterTree=e.filterTree,this.havingTree=e.havingTree,this.skipNumber=e.skipNumber||0,this.limitNumber=e.limitNumber,this.cursor=e.cursor,this.invalidArguments=e.invalidArguments||[]}filter(e){const[t]=this._aggregateValidator(".filter").arityIsOne(arguments).filterBuilder(e).validateAndAggregate();return new Ve({provider:this.provider,collectionName:this.collectionName,filterTree:e.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t.concat(e.invalidArguments)})}getFilter(){return ye({filterTree:this.filterTree})}group(...e){let t=(0,i.o)(this.groupByTree);const[r]=this._aggregateValidator(".group").arityIsAtLeastOne(arguments).validateAndAggregate();return t?"0"===t._id?t={...t,_id:We(...e)}:t._id=We(...e):t={_id:We(...e)},new Ve({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:t,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:r})}having(e){const[t]=this._aggregateValidator(".having").arityIsOne(arguments).filterBuilder(e).validateAndAggregate();return new Ve({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:e.filterTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t.concat(e.invalidArguments)})}getHaving(){return ye({filterTree:this.havingTree})}skip(e){const[t]=this._aggregateValidator(".skip").arityIsOne(arguments).isNonNegativeNumber(e).isInteger(e).validateAndAggregate();return new Ve({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:e,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t})}limit(e){const[t]=this._aggregateValidator(".limit").arityIsOne(arguments).isPositiveNumber(e).isInteger(e).validateAndAggregate();return new Ve({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:e,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t})}run(e){const t=this,r=this._buildPipeline();return(i=this.invalidArguments,n=this.collectionName,i.length>0?Promise.reject(U(v.aggregateInvalid(n,i))):Promise.resolve()).then(()=>X().options(e).validateAndReject()).then(()=>this.provider.runAggregate(this.collectionName,r,this.limitNumber,e,this.cursor)).then(({items:e,hasNext:r,cursors:i})=>new qe({items:e,hasNext:r,aggregate:t,pageSize:e.length,cursors:i,createdByCursor:this.cursor}));var i,n}_buildPipeline(){return[this.filterTree?{$match:this.filterTree}:null,this.groupByTree?{$group:this.groupByTree}:null,this.groupByTree?{$project:Be(this.groupByTree)}:null,this.havingTree?{$match:this.havingTree}:null,this.orderBy.length>0?{$sort:this.orderBy}:null,{$skip:this.skipNumber}].filter(e=>null!==e)}_aggregateValidator(e){return new ze(e,this.invalidArguments)}}function Be(e){const t=Object.keys(e).map(e=>({[e]:1}));return(0,n.Gv)(e._id)?t.push(function(e){const t=Object.keys(e),r=t.map(e=>({[e]:`$_id.${e}`}));return Object.assign({},...r)}(e._id)):(0,n.Kg)(e._id)&&"0"!==e._id&&t.push({[e._id.substr(1)]:"$_id"}),Object.assign({},...t)}function Me(e,t,r,i){return new Ve({provider:e,collectionName:t,cursor:i,limitNumber:r})}class qe{constructor(e){e&&(this._items=e.items,this._hasNext=e.hasNext,this._aggregate=e.aggregate,this._pageSize=e.pageSize,this._cursors=e.cursors,this._createdByCursor=e.createdByCursor)}get items(){return this._items}hasNext(){return this._hasNext}hasPrev(){return De(this._createdByCursor)||this._cursors?De(this.prevCursor):this._aggregate.skipNumber>0}get length(){return this._items.length}next(){if(!this.hasNext())return this._rejectNoNextPage();let e;if(De(this.nextCursor))e=this._getNewCursorAggregate(this.nextCursor);else{const t=Fe(this._aggregate,this.length,!0);e=this._aggregate.skip(t)}return e.run()}prev(){if(!this.hasPrev())return this._rejectNoPrevPage();let e;return e=De(this.prevCursor)?this._getNewCursorAggregate(this.prevCursor):this._aggregate.skip(Math.max(0,this._aggregate.skipNumber-this._aggregate.limitNumber)),e.run()}get nextCursor(){return this._cursors&&this._cursors.next}get prevCursor(){return this._cursors&&this._cursors.prev}_getNewCursorAggregate(e){const t=this._aggregate;return Me(t.provider,t.collectionName,t.limitNumber,e)}_rejectNoPrevPage(){return Promise.reject(U($.noPrevPage(this._aggregate.collectionName)))}_rejectNoNextPage(){return Promise.reject(U($.noNextPage(this._aggregate.collectionName)))}}const Ue=9007199254740991;class ze extends H{constructor(e,t){super(t),this.operatorName=e}filterBuilder(e){return this.addValidation(()=>"FilterBuilder"===e.constructorName,()=>v.filterMustBeBuilder(this.operatorName))}_isNumber(e,t){return this.addValidation(()=>(0,n.Et)(t),()=>$.isNumber(this.operatorName,e,t))}isPositiveNumber(e){return this._isNumber("positive",e).addValidation(()=>!Number.isNaN(e)&&e>0,()=>$.isPositiveNumber(this.operatorName,e))}isNonNegativeNumber(e){return this._isNumber("non-negative",e).addValidation(()=>!Number.isNaN(e)&&e>=0,()=>$.isNonNegativeNumber(this.operatorName,e))}isInteger(e){return this.addValidation(()=>!Number.isNaN(e)&&Number.isFinite(e)&&Number.isInteger(e)&&e<Ue&&e>-9007199254740991,()=>$.isInteger(this.operatorName,e))}}var Le,Ke,Ge,He,Qe,Je,Xe;!function(e){e.LIVE="LIVE",e.SANDBOX="SANDBOX",e.SANDBOX_PREFERRED="SANDBOX_PREFERRED"}(Le||(Le={})),function(e){e.UNKNOWN_ACTION="UNKNOWN_ACTION",e.SET_FIELD="SET_FIELD",e.REMOVE_FIELD="REMOVE_FIELD",e.INCREMENT_FIELD="INCREMENT_FIELD",e.APPEND_TO_ARRAY="APPEND_TO_ARRAY",e.REMOVE_FROM_ARRAY="REMOVE_FROM_ARRAY"}(Ke||(Ke={})),function(e){e.UNKNOWN_ACTION_TYPE="UNKNOWN_ACTION_TYPE",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE",e.PATCH="PATCH"}(Ge||(Ge={})),function(e){e.UNKNOWN_ACTION="UNKNOWN_ACTION",e.INSERTED="INSERTED",e.UPDATED="UPDATED"}(He||(He={})),function(e){e.ASC="ASC",e.DESC="DESC"}(Qe||(Qe={})),function(e){e.UNKNOWN_SORT_MODE="UNKNOWN_SORT_MODE",e.WIX_QUERY="WIX_QUERY",e.RANDOM="RANDOM"}(Je||(Je={})),function(e){e.OR="OR",e.AND="AND"}(Xe||(Xe={}));class Ye extends(Ae()){get constructorName(){return"FilterBuilder"}_build(){return this.getFilterModel()}}Ae();function Ze(){return new Ye({})}class et extends(Ee()){_build(){return this.getSortModel()}}class tt{constructor(e){e&&(this.count=e.count,this.total=e.total,this.cursors=e.cursors,this.hasNext=e.hasNext,this.hasPrev=e.hasPrev)}}class rt{constructor(e){if(!e)return;this._provider=e.provider,this._collectionName=e.collectionName,this._referenceAttribute=e.referenceAttribute,this._holdingItemId=e.holdingItemId,this._items=e.items,this._totalCount=e.totalCount,this._options=e.options;const{skip:t=0,limit:r}=e.options||{};this._skip=t,this._limit=r,this._cursors=e.cursors,this._createdByCursor=e.createdByCursor,this._hasNext=e.hasNext}get items(){return this._items}get totalCount(){return this._totalCount}get nextCursor(){return this._cursors&&this._cursors.next}get prevCursor(){return this._cursors&&this._cursors.prev}hasNext(){return this._hasNext}hasPrev(){return De(this._createdByCursor)||this._cursors?De(this.prevCursor):this._skip>0}next(){return this.hasNext()?De(this.nextCursor)?this._getNewCursorQuery(this.nextCursor)._fetch().then(e=>e._withTotalCount(this._totalCount)):this._withChangedSkip(!0)._fetch():this._rejectNoNextPage()}prev(){return this.hasPrev()?De(this.prevCursor)?this._getNewCursorQuery(this.prevCursor)._fetch().then(e=>e._withTotalCount(this._totalCount)):this._withChangedSkip(!1)._fetch():this._rejectNoPrevPage()}_rejectNoPrevPage(){return Promise.reject(U($.noPrevPage(this._collectionName)))}_rejectNoNextPage(){return Promise.reject(U($.noNextPage(this._collectionName)))}_withChangedSkip(e){const t=Fe({skipNumber:this._skip,limitNumber:this._limit},this._items.length,e);return it({items:this._items,totalCount:this._totalCount,pagingMetadata:new tt({total:this._totalCount})},this._provider,this._collectionName,this._holdingItemId,this._referenceAttribute,{...this._options,skip:t,limit:this._limit})}_getNewCursorQuery(e){return it({},this._provider,this._collectionName,"",this._referenceAttribute,{cursor:e,limit:this._limit,omitTotalCount:!0})}_fetch(){return this._provider.queryReferenced(this._collectionName,this._holdingItemId,this._referenceAttribute,this._options).then(e=>it(e,this._provider,this._collectionName,this._holdingItemId,this._referenceAttribute,this._options))}_withTotalCount(e){return this._totalCount=e,this}}function it(e,t,r,i,n,a){const{items:s,totalCount:o,pagingMetadata:u}=e,{total:l,cursors:c,hasNext:d=!1}=u||new tt;return new rt({provider:t,collectionName:r,referenceAttribute:n,holdingItemId:i,items:s,totalCount:l||o,options:a,cursors:c,createdByCursor:a?.cursor,hasNext:d})}function nt(e,t){if(!e)return!1;if(Array.isArray(e))return e.some(e=>nt(e,t));if("object"==typeof e){return Object.keys(e).some(r=>t(r)||nt(e[r],t))}return!1}class at{constructor(e){this.environment=Le,this.withEnvironment=e=>new at(this.provider.withEnvironment(e)),this.get=st((e,t,r,i)=>X().arity("get",e,2,3).collectionName(t).itemId(r).options(i).validateAndReject().then(()=>this.provider.get(t,r,i)).then(ut)),this.insert=st((e,t,r,i)=>X().arity("insert",e,2,3).validateAndReject().then(()=>ot(this.provider,"insert")(t,r,i))),this.query=e=>je(this.provider,e),this.filter=()=>Ze(),this.sort=()=>new et,this.find=(e,t,r,i,n,a,s,o)=>{const u=je(this.provider,e);u.filterTree=t,u.orderBy=r,u.skipNumber=i,u.limitNumber=n,u.included=s;const l={...a,omitTotalCount:o};return u.find(l)},this.remove=st((e,t,r,i)=>X().arity("remove",e,2,3).collectionName(t).itemId(r).options(i).validateAndReject().then(()=>this.provider.remove(t,r,i)).then(ut)),this.truncate=st((e,t,r)=>X().arity("truncate",e,1,2).collectionName(t).options(r).validateAndReject().then(()=>this.provider.truncate(t,r)).then(ut)),this.bulkRemove=st((e,t,r,i)=>X().arity("bulkRemove",e,2,3).collectionName(t).itemIds(r,t).options(i).validateAndReject().then(()=>this.provider.bulkRemove(t,r,i)).then(ut).then(e=>{const t=e.errors.map(e=>new K(e.message,e.code,e.item,e.name,e.originalIndex));return{...e,errors:t}})),this.save=st((e,t,r,i)=>X().arity("save",e,2,3).validateAndReject().then(()=>ot(this.provider,"save")(t,r,i))),this.update=st((e,t,r,i)=>X().arity("update",e,2,3).validateAndReject().then(()=>ot(this.provider,"update")(t,r,i))),this.fetch=st((e,t,r,i,n)=>X().arity("fetch",e,3,4).isNonEmptyString(r,"cursor").validateAndReject().then(()=>{const e=je(this.provider,t).limit(i);return e.cursor=r,e.included=void 0,e.projectedFields=void 0,e.filterTree=void 0,e.skipNumber=void 0,e.find(n)})),this.fetchReferenced=st((e,t,r,i,n)=>X().arity("fetchReferenced",e,3,4).isNonEmptyString(r,"cursor").validateAndReject().then(()=>{const e={...n};return e.limit=i,e.cursor=r,e.omitTotalCount=!0,this.provider.queryReferenced(t,void 0,void 0,e).then(r=>it(r,this.provider,t,void 0,void 0,e))})),this.fetchAggregate=st((e,t,r,i,n)=>X().arity("fetchAggregate",e,3,4).isNonEmptyString(r,"cursor").validateAndReject().then(()=>Me(this.provider,t,i,r).run(n))),this.queryReferenced=st((e,t,r,i,n)=>X().arity("queryReferenced",e,3,4).referenceParameter(r).validateAndReject().then(()=>{const e=ct(r),a=n||{};return this.provider.queryReferenced(t,e,i,a).then(r=>it(r,this.provider,t,e,i,n))})),this.insertReference=st((e,t,r,i,a,s)=>{let o,u,l;return(0,n.cy)(r)?(u=r,o=i,l=()=>X().arity("insertReference",e,2,3).references(u).validateAndReject()):(u=lt(a).map(e=>({relationshipName:r,left:i,right:e})),o=s,l=()=>X().arity("insertReference",e,4,5).references(u).validateAndReject()),l().then(()=>this.provider.insertReferences(t,(e=>e.map(e=>({relationshipName:e.relationshipName,left:ct(e.left),right:ct(e.right)})))(u),o))}),this.replaceReferences=st((e,t,r,i,n,a)=>(n=lt(n).map(ct),i=ct(i),X().arity("replaceReferences",e,4,5).referenceParameter(i).referenceParameters(n).validateAndReject().then(()=>this.provider.replaceReferences(t,{relationshipName:r,left:i},n.map(e=>({relationshipName:r,right:e,left:i})),a)))),this.removeReference=st((e,t,r,i,n,a)=>(n=lt(n).map(ct),i=ct(i),X().arity("removeReference",e,4,5).referenceParameter(i).referenceRemoveParameters(n).validateAndReject().then(()=>1===n.length?this.provider.removeReference(t,r,i,n[0],a):this.provider.removeReferences(t,n.map(e=>({relationshipName:r,right:e,left:i})),a)))),this.isReferenced=st((e,t,r,i,n,a)=>X().arity("isReferenced",e,4,5).referenceParameter(i).referenceParameter(n).validateAndReject().then(()=>this.provider.isReferenced(t,r,ct(i),ct(n),a))),this.bulkInsert=st((e,t,r,i)=>X().arity("bulkInsert",e,2,3).validateAndReject().then(()=>this.provider.bulkInsert(t,r,i)).then(e=>{const t=e.errors.map(e=>new K(e.message,e.code,e.item,e.name,e.originalIndex));return{...e,errors:t}})),this.bulkSave=st((e,t,r,i)=>X().arity("bulkSave",e,2,3).validateAndReject().then(()=>this.provider.bulkSave(t,r,i)).then(e=>{const t=e.errors.map(e=>new K(e.message,e.code,e.item,e.name,e.originalIndex));return{...e,errors:t}})),this.bulkUpdate=st((e,t,r,i)=>X().arity("bulkUpdate",e,2,3).validateAndReject().then(()=>this.provider.bulkUpdate(t,r,i)).then(e=>{const t=e.errors.map(e=>new K(e.message,e.code,e.item,e.name,e.originalIndex));return{...e,errors:t}})),this.getSchema=()=>this.provider.getSchema(),this.group=(...e)=>Re(...e),this.aggregate=e=>function(e,t){return new Ve({provider:e,collectionName:t})}(this.provider,e),this.provider=e}get wixData(){return this}}function st(e){return function(...t){return e(arguments,...t)}}function ot(e,t,r=!1){return(i,n,a)=>{return X().collectionName(i).item(n,i,r).options(a).validateAndReject().then(()=>function(e){const t=nt(e,e=>e.startsWith("$")),r=nt(e,e=>e.includes("."));t&&console.error("Data inserted contains field name prefixed with symbol '$'. It is not recommended to use such field names as it will not work with some data operations.");r&&console.warn("Data inserted contains field name containing symbol '.'. It is not recommended to use such field names as it will not work with some data operations.")}(n)).then(()=>e[t](i,n,a)).then(ut).then((s=n,function(e){if(e){for(const t in e)e.hasOwnProperty(t)&&(s.hasOwnProperty(t)&&!0!==Object.getOwnPropertyDescriptor(s,t)?.writable||(s[t]=e[t]));for(const t in s)e.hasOwnProperty(t)||delete s[t];return s}}));var s}}function ut(e){return e&&e.hasOwnProperty("item")?e.item:e}function lt(e){return(0,n.cy)(e)?e:[e]}function ct(e){return(0,n.Gv)(e)?e._id:e}Ee();Ae();const{getSchemaNamespace:dt}=r(48699);var ht=r(7488);function mt(e){return"WDE0020"===e||"WDE0024"===e?F:"WDE0025"===e?B:"WDE0026"===e?V:"WDE0027"===e?M:"WDE0052"===e?R:"WDE0073"===e?k:"WDE0074"===e?x:"WDE0022"===e||"WDE0007"===e?F:e}const pt="WDE0109",gt="WDE0080",ft=e=>t=>e("wix-data-error-response",{responseData:t?.response?.data,status:t?.response?.status,requestId:t?.response?.headers?.["x-wix-request-id"],error:t?.response?t.response:t})(()=>Promise.resolve()).then(()=>{if(function(e){return 413===e?.response?.status}(t))return q(w(),pt);const e=t?.response?.data;return vt(e)?function(e){const t=e.details.applicationError.data,r=t?.jsErrorValue||!t?.value&&e.details.applicationError;if(r){const{name:t,message:i,code:n,description:a}=r,s=new Error(i||a);return s.name=t||a,s.code=n,s.details=e.details,s}return t?.value}(e):function(e){return e?.details?.applicationError}(e)?yt(e):function(e){return e?.details?.validationError}(e)?function(e){const t=(e.details.validationError.fieldViolations||[]).map(e=>`${e.field}: ${e.description}`),r=[e.message,...t].join("\n");return q(r,gt,e.details)}(e):function(e){return(e?.message||"").startsWith("WDE")}(t)?t:function(e){const t=e=>e instanceof Error?`${e}`:JSON.stringify(e),r=e?.response?.headers?.["x-wix-request-id"],i=e?.response?.status,n=e?.response?.statusText,a=e?.response?e.response:e;let s=i?`${i}`:"";return s+=n?`(${n})`:"",s+=r?` ${r}`:"",s=s||t(e),q(T(s),W,a)}(t)}).then(e=>Promise.reject(e));function vt(e){return"WDE0078"===e?.details?.applicationError?.code}const yt=e=>{const t=mt(e.details.applicationError.code);return q(e.details.applicationError.description,t,e.details)};const Nt=e=>t=>_t(e)({message:t.itemMetadata.error.description,details:{applicationError:{code:t.itemMetadata.error.code,description:t.itemMetadata.error.description}},originalIndex:t.itemMetadata.originalIndex}),_t=e=>t=>{const{message:r,code:i,name:n}=function(e){const t=e.details?.applicationError;if(vt(e)){const e=t.data?.jsErrorValue;if(e)return{message:e.message,code:e.code,name:e.name};const r=t.data?.value;return"string"==typeof r?{message:r}:{}}return{code:mt(t?.code)||W,message:t?.description||e.message,name:"Error"}}(t);return{message:r,code:i,name:n,originalIndex:t.originalIndex,item:e[t.originalIndex]}};var It=r(11691),At=r(86859);const bt=()=>e=>e();function $t(e){const t="object"==typeof e?Object.keys(e).filter(t=>"object"==typeof e[t]&&"_id"!==t).map(t=>{const r=e[t],i=(e=>{switch(Object.keys(e)[0]){case"$sum":return"sum";case"$min":return"min";case"$avg":return"average";case"$max":return"max";default:return""}})(r),n=(e=>{const t=Object.values(e)[0];return"string"==typeof t&&t.startsWith("$")?t.substring(1):t})(r),a={resultFieldName:t};return"sum"===i&&1===n?a.itemCount={}:a[i]={itemFieldName:n},a}):[],r={groupingFields:(e=>"object"==typeof e?"object"==typeof e._id?Object.keys(e._id):"0"===e._id?[]:[e._id.substring(1)]:[])(e),operations:t};return r}const Et=e=>"object"==typeof e&&null!==e&&"get"in e&&"function"==typeof e.get;class St{constructor({cloudDataUrl:e="/_api/cloud-data",gridAppId:t,environment:r,httpClient:i,authHeader:n,traceWith:a=bt}){this.cloudDataUrl=e,this.gridAppId=t,this.environment=r,this.httpClientProvider="function"==typeof i?i:()=>i,this.traceWith=a,this.authHeader=n}withEnvironment(e){return new St({cloudDataUrl:this.cloudDataUrl,gridAppId:this.gridAppId,environment:e,httpClient:this.httpClientProvider,authHeader:this.authHeader,traceWith:this.traceWith})}_unwrapDataItems(e){return e.map(e=>e.data)}_unwrapDataItem(e){return e&&e.hasOwnProperty("dataItem")&&e.dataItem.hasOwnProperty("data")?{item:e.dataItem.data}:e}insert(e,t,r){return this._traceWith("platformized-provider-insert",{collectionName:e})(()=>X().collectionName(e).item(t,e,!1).options(r).validateAndReject().then(()=>this._post("/v2/items",{...Ot(r),dataCollectionId:e,dataItem:{id:t._id,dataCollectionId:e,data:t}},r,this.insert.name)).then(this._unwrapDataItem))}update(e,t,r){return this._traceWith("platformized-provider-update",{collectionName:e})(()=>X().collectionName(e).item(t,e,!1).options(r).validateAndReject().then(()=>this._post("/v2/items/update",{...Ot(r),dataCollectionId:e,dataItem:{id:t._id,dataCollectionId:e,data:t}},r,this.update.name)).then(this._unwrapDataItem))}save(e,t,r){return this._traceWith("platformized-provider-save",{collectionName:e})(()=>X().collectionName(e).item(t,e,!1).options(r).validateAndReject().then(()=>this._post("/v2/items/save",{...Ot(r),dataCollectionId:e,dataItem:{id:t._id,dataCollectionId:e,data:t}},r,this.save.name)).then(this._unwrapDataItem))}truncate(e,t){return this._traceWith("platformized-provider-truncate",{collectionName:e})(()=>X().collectionName(e).validateAndReject().then(()=>this._post("/v2/items/truncate",{dataCollectionId:e},t,this.truncate.name)).then(()=>Promise.resolve(null)))}remove(e,t,r){return this._traceWith("platformized-provider-remove",{collectionName:e})(()=>X().collectionName(e).itemId(t).options(r).validateAndReject().then(()=>this._post("/v2/items/remove",{...Ot(r),dataCollectionId:e,dataItemId:t},r,this.remove.name)).then(this._unwrapDataItem).catch(e=>e&&e.code===k?Promise.resolve(null):Promise.reject(e)))}bulkRemove(e,t,r){return this._traceWith("platformized-provider-bulk-remove",{collectionName:e})(()=>X().collectionName(e).itemIds(t,e).bulkRemoveOptions(r).validateAndReject().then(()=>0===t.length?{removedItemIds:[],removed:0,skipped:0,errors:[]}:this._post("/v2/bulk/items/remove",{...Ot(r),dataCollectionId:e,dataItemIds:t},r,this.bulkRemove.name).then(({results:e})=>{const r=e.filter(e=>e.itemMetadata.success),i=e.filter(e=>!e.itemMetadata.success&&"WDE0073"!==e.itemMetadata.error.code),n=r.map(e=>e.itemMetadata.id);return{removedItemIds:n,removed:n.length,skipped:t.length-n.length-i.length,errors:i.map(Nt(t))}}).catch(e=>e&&e.code===k?Promise.resolve(null):Promise.reject(e))))}get(e,t,r){return this._traceWith("platformized-provider-get",{collectionName:e,itemId:t})(()=>X().collectionName(e).itemId(t).options(r).validateAndReject().then(()=>encodeURIComponent(t)===t?this._get(`/v2/items/${t}`,{...Ot(r),dataCollectionId:e,dataItemId:t},r,this.get.name):this._post("/v2/items/get",{...Ot(r),dataCollectionId:e,dataItemId:t},r,this.get.name)).then(this._unwrapDataItem).catch(e=>e&&e.code===k?Promise.resolve(null):Promise.reject(e)))}find(e,t,r,i,a,s,o,u,l,c,d){return this._traceWith("platformized-provider-find",{collectionName:e})(()=>X().collectionName(e).options(s).validateAndReject().then(()=>this._validateOrderBy(e,r)).then(()=>this._validateFilter(e,t)).then(()=>{const h=this._getDataQuery(t,r,a,i,l,c),m=(0,n.cy)(o)?o.map(e=>({fieldName:e})):void 0;return this._get("/v2/items/query",{...Ot(s),dataCollectionId:e,query:h,referencedItemOptions:m,returnTotalCount:!u,...d?{sortMode:"RANDOM",randomOptions:{seed:d.seed}}:{}},s,this.find.name).then(e=>{const{dataItems:t,pagingMetadata:r}=e,i=this._unwrapDataItems(t),a=!!i.find(e=>!(!(0,n.cy)(o)||!o.find(t=>{const r=e[t];return(0,n.cy)(r)&&r.length>=50})));return{items:i,partialIncludes:a,totalCount:r.total,pagingMetadata:r}})}))}runAggregate(e,t,r,i,n){return this._traceWith("platformized-provider-aggregate",{collectionName:e})(()=>X().collectionName(e).options(i).validateAndReject().then(()=>{const a=(0,It.A)(t);return this._get("/v2/items/aggregate",{...Ot(i),dataCollectionId:e,initialFilter:a.preFilteringStep,aggregation:$t(a.processingStep),finalFilter:a.postFilteringStep,sort:this._platformizedSort(t),...this._getAggregatePaging(t,r,n)},i,this.runAggregate.name).then(e=>{const{results:t,pagingMetadata:{cursors:r,hasNext:i}}=e;return{items:t.map(e=>{if("object"==typeof e._id&&1===Object.keys(e._id).length){const t=e._id[Object.keys(e._id)[0]];e._id=t}return e}),hasNext:i,cursors:r}})}))}_platformizedSort(e){const t=e.find(e=>e.hasOwnProperty("$sort"));if(!t)return;return t.$sort.map(e=>{const[t,r]=Object.entries(e)[0];return{fieldName:t,order:"asc"===r?0:1}})}_getDataQuery(e,t,r,i,n,a){return{filter:e,sort:t?this._mapOrderToSort(t):void 0,...this._getPaging(r,i,n),fields:a}}_getAggregatePaging(e,t,r){const i=e.find(e=>e.hasOwnProperty("$skip")),n=void 0!==i?i.$skip:void 0;return this._getPaging(t,n,r)}_getPaging(e,t,r){if(r&&t>0)throw q(j(),F);return r?{cursorPaging:{limit:e,cursor:r}}:{paging:{offset:t,limit:e}}}count(e,t,r){return this._traceWith("platformized-provider-count",{collectionName:e})(()=>X().collectionName(e).options(r).validateAndReject().then(()=>this._validateFilter(e,t)).then(()=>this._get("/v2/items/count",{...Ot(r),dataCollectionId:e,filter:t},r,this.count.name)))}_sortingFromOrder(e,t){const r=((0,n.cy)(e)?e:[]).find(e=>e.hasOwnProperty(t)),i=r&&r.hasOwnProperty(t)?r[t]:void 0;return i?i.toUpperCase():i}distinct(e,t,r,i,n,a,s,o,u,l){return this._traceWith("platformized-provider-distinct",{collectionName:e})(()=>X().collectionName(e).options(s).validateAndReject().then(()=>this._validateOrderBy(e,r)).then(()=>this._validateFilter(e,t)).then(()=>{const c=this._getDataQuery(t,r,a,n,o,u);return this._get("/v2/items/query-distinct-values",{...Ot(s),dataCollectionId:e,fieldName:i,filter:c.filter,order:this._sortingFromOrder(r,i),paging:c.paging,cursorPaging:c.cursorPaging,...l?{}:{returnTotalCount:!0}},s,this.distinct.name).then(({distinctValues:e,pagingMetadata:t})=>({items:e,totalCount:t.total,pagingMetadata:t}))}))}bulkInsert(e,t,r){return this._traceWith("platformized-provider-bulk-insert",{collectionName:e})(()=>{const i=(r||{}).overrideExisting;return X().collectionName(e).items(t,e).bulkInsertOptions(r).validateAndReject().then(()=>{if(0===t.length)return{insertedItemIds:[],inserted:0,errors:[],skipped:0,updated:0};const n=i?"/v2/bulk/items/save":"/v2/bulk/items/insert";return this._post(n,{...Ot(r),dataCollectionId:e,dataItems:t.map(t=>({id:t._id,dataCollectionId:e,data:t}))},r,this.bulkInsert.name).then(({results:e})=>{const r=e.filter(e=>e.itemMetadata.success),n=r.map(e=>e.itemMetadata.id),a=r.filter(e=>"INSERT"===e.action).length,s=r.filter(e=>"UPDATE"===e.action).length,o=e.filter(e=>!e.itemMetadata.success&&"WDE0074"!==e.itemMetadata.error.code);return{insertedItemIds:n,inserted:a,skipped:i?0:t.length-n.length-o.length,updated:s,errors:o.map(Nt(t))}})})})}bulkSave(e,t,r){return this._traceWith("platformized-provider-bulk-save",{collectionName:e})(()=>X().collectionName(e).items(t,e).bulkInsertOptions(r).validateAndReject().then(()=>0===t.length?{insertedItemIds:[],updatedItemIds:[],inserted:0,updated:0,skipped:0,errors:[]}:this._post("/v2/bulk/items/save",{...Ot(r),dataCollectionId:e,dataItems:t.map(t=>({id:t._id,dataCollectionId:e,data:t}))},r,this.bulkSave.name).then(({results:e})=>{const r=e.filter(e=>e.itemMetadata.success),i=r.filter(e=>"INSERT"===e.action),n=r.filter(e=>"UPDATE"===e.action),a=i.map(e=>e.itemMetadata.id),s=n.map(e=>e.itemMetadata.id),o=e.filter(e=>!e.itemMetadata.success);return{insertedItemIds:a,updatedItemIds:s,inserted:i.length,skipped:t.length-a.length-s.length-o.length,updated:n.length,errors:o.map(Nt(t))}})))}bulkUpdate(e,t,r){return this._traceWith("platformized-provider-bulk-update",{collectionName:e})(()=>X().collectionName(e).items(t,e).bulkUpdateOptions(r).validateAndReject().then(()=>0===t.length?{updatedItemIds:[],inserted:0,skipped:0,updated:0,errors:[]}:this._post("/v2/bulk/items/update",{...Ot(r),dataCollectionId:e,dataItems:t.map(t=>({id:t._id,dataCollectionId:e,data:t}))},r,this.bulkUpdate.name).then(({results:e})=>{const r=e.filter(e=>e.itemMetadata.success).filter(e=>"UPDATE"===e.action),i=r.map(e=>e.itemMetadata.id),n=e.filter(e=>!e.itemMetadata.success&&"WDE0073"!==e.itemMetadata.error.code);return{updatedItemIds:i,inserted:0,skipped:t.length-i.length-n.length,updated:r.length,errors:n.map(Nt(t))}})))}queryReferenced(e,t,r,i){return this._traceWith("platformized-provider-query-referenced",{collectionName:e,order:i.order,skip:i.skip,limit:i.limit,cursorExists:i.cursor?"true":"false"})(()=>{const n=((i=i||{}).order||"ASC").toUpperCase(),a=i.skip||0,s=i.limit||50,o=i.cursor;return X().collectionName(e).options(i).validateAndReject().then(()=>this._get("/v2/items/query-referenced",{...Ot(i),dataCollectionId:e,referringItemId:t,referringItemFieldName:r,order:n,...i?.omitTotalCount?{}:{returnTotalCount:!0},...this._getPaging(s,a,o)},i,this.queryReferenced.name)).then(({results:e,pagingMetadata:t})=>({items:e.filter(e=>!!e.dataItem).map(e=>e.dataItem.data),totalCount:t.total,pagingMetadata:t}))})}insertReference(e,t,r,i,n){return this._traceWith("platformized-provider-insert-reference",{collectionName:e})(()=>this.insertReferences(e,[{relationshipName:t,left:r,right:i}],n))}insertReferences(e,t,r){return this._traceWith("platformized-provider-insert-references",{collectionName:e})(()=>X().collectionName(e).options(r).validateAndReject().then(()=>{const i=t.map(({relationshipName:e,left:t,right:r})=>({referringItemFieldName:e,referringItemId:t,referencedItemId:r}));return this._post("/v2/bulk/items/insert-references",{...Ot(r),dataCollectionId:e,dataItemReferences:i},r,this.insertReferences.name)}))}replaceReferences(e,t,r,i){return this._traceWith("platformized-provider-replace-references",{collectionName:e})(()=>X().collectionName(e).options(i).validateAndReject().then(()=>this._post("/v2/items/replace-references",{...Ot(i),dataCollectionId:e,referringItemFieldName:t.relationshipName,referringItemId:t.left,newReferencedItemIds:r.map(({right:e})=>e)},i,this.replaceReferences.name)))}removeReference(e,t,r,i,n){return this._traceWith("platformized-provider-remove-reference",{collectionName:e})(()=>this.removeReferences(e,[{relationshipName:t,left:r,right:i}],n))}removeReferences(e,t,r){return this._traceWith("platformized-provider-remove-references",{collectionName:e})(()=>X().collectionName(e).options(r).validateAndReject().then(()=>this._post("/v2/bulk/items/remove-references",{...Ot(r),dataCollectionId:e,dataItemReferences:t.map(({relationshipName:e,left:t,right:r})=>({referringItemFieldName:e,referringItemId:t,referencedItemId:r}))},r,this.removeReferences.name)))}isReferenced(e,t,r,i,n){return this._traceWith("platformized-provider-is-referenced",{collectionName:e})(()=>X().collectionName(e).options(n).validateAndReject().then(()=>this._post("/v2/items/is-referenced",{...Ot(n),dataCollectionId:e,referringItemFieldName:t,referringItemId:r,referencedItemId:i},n,this.isReferenced.name)).then(({isReferenced:e})=>e))}_mapOrderToSort(e){return e.flatMap(e=>Object.entries(e).map(([e,t])=>({fieldName:e,order:t.toUpperCase()})))}_validateOrderBy(e,t){const r=e=>C.sortModelType(e);if([null,void 0].includes(t))return Promise.resolve();if(i=t,!(0,n.cy)(i))return Promise.reject(this._validationError(e,[r(t)]));var i;const a=t.flatMap(e=>(e=>!(0,n.Gv)(e))(e)?(e=>C.sortModelItemType(e))(e):(e=>{const t=Object.values(e);return!(1===t.length&&("asc"===t[0]||"desc"===t[0]))})(e)?(e=>C.sortModelItem(e))(e):[]);return a.length?Promise.reject(this._validationError(e,a)):Promise.resolve()}_validateFilter(e,t){const r=O.objectType,i=O.arrayType,a=O.arrayLength,s=O.comparisonOperatorType,o=O.stringOperatorType,u=O.setOperatorItems,l=O.inOperatorItems,c=O.matchesOperatorRequiredProperty,d=O.matchesOperatorIgnoreCase,h=O.matchesOperatorSpecItems,m=O.regexNotAllowed,p=(e,t)=>void 0===t||(0,n.Gv)(t)?[]:[r(e,t)],g=(e,t)=>(0,n.cy)(t)?t.flatMap(t=>p(e,t)):[],f=(e,t)=>void 0===t||(0,n.cy)(t)?[]:[i(e,t)],v=(e,t)=>void 0===t||(0,n.Kg)(t)||(0,n.Et)(t)||(0,n.$P)(t)?[]:[s(e,t)],y=(e,t)=>void 0===t||(0,n.Kg)(t)?[]:[o(e,t)],N=(e,t)=>(0,n.cy)(t)?t.every(e=>(0,n.$P)(e)||(0,n.Kg)(e)||(0,n.Et)(e))?[]:[u(e,t)]:[],_=(e,t,r)=>(0,n.cy)(t)?t.length===r?[]:[a(e,r,t)]:[],I=e=>{if(!(0,n.Gv)(e))return[];if(void 0===e.ignoreCase)return[c("ignoreCase",e)];if(!0!==e.ignoreCase)return[d(e.ignoreCase)];if(void 0===e.spec)return[c("spec",e)];if(!(0,n.cy)(e.spec))return[i("$matches.spec",e.spec)];const t=e.spec.find(e=>!(e=>!!(0,n.Gv)(e)&&("anyOf"===e.type&&" \t\n-"===e.value||!("literal"!==e.type||!(0,n.Kg)(e.value))))(e));return void 0!==t?[h(t)]:[]},A=e=>{if(!(0,n.Gv)(e))return[];const{$and:t,$or:r,$not:i,$gt:a,$gte:s,$lt:o,$lte:u,$startsWith:c,$endsWith:d,$contains:h,$hasSome:b,$hasAll:$,$in:E,$matches:S,$regex:O,...D}=e;let C=[].concat(f("$and",t)).concat(g("Filter Model",t)).concat(f("$or",r)).concat(g("Filter Model",r)).concat(f("$not",i)).concat(g("Filter Model",i)).concat(f("$hasSome",b)).concat(f("$hasAll",$)).concat(f("$in",E)).concat(N("$hasSome",b)).concat(N("$hasAll",$)).concat(v("$gt",a)).concat(v("$gte",s)).concat(v("$lt",o)).concat(v("$lte",u)).concat(y("$startsWith",c)).concat(y("$endsWith",d)).concat(y("$contains",h)).concat(_("$not",i,1)).concat(_("$in",E,2)).concat((T=E,(0,n.cy)(T)?2!==T.length||(0,n.Kg)(T[0])&&(0,n.Et)(T[1])?[]:[l(T)]:[])).concat(p("$matches",S)).concat(I(S)).concat((e=>void 0===e?[]:[m()])(O));var T;return C.length?C:(C=[].concat(t?t.flatMap(A):[]).concat(r?r.flatMap(A):[]).concat(i?i.flatMap(A):[]),C.length?C:Object.values(D).flatMap(A))};if([null,void 0].includes(t))return Promise.resolve();if(!(0,n.Gv)(t))return Promise.reject(this._validationError(e,[r("Filter Model",t)]));const b=A(t);return b.length?Promise.reject(this._validationError(e,b)):Promise.resolve()}_validationError(e,t){return U($.queryInvalid(e,t))}_getAuthHeader(){return Promise.resolve(Et(this.authHeader)?this.authHeader.get():this.authHeader)}_get(e,t,r,i){return this._call(e,t,!0,r,i)}_post(e,t,r,i){return this._call(e,t,!1,r,i)}_call(e,t,r,i,n){return Promise.all([this._getGridAppId(),this._getAuthHeader()]).then(([a,s])=>{const o=`${this.cloudDataUrl}${e}`,u=e=>this.traceWith("wix-data-api-call",{url:o})(()=>{const e={...(0,ht.oq)(t),environment:this.environment,appId:a},u=((e,t)=>({headers:e,includeWixHeaders:!0,automaticLogsOptions:{packageName:"wix-data",functionName:t}}))(s?{authorization:s}:{},n);if(r){const t=`${o}?.r=${(0,At.A)(e)}`;if(t.length<=2048)return this.httpClientProvider(i).get(t,u)}return this.httpClientProvider(i).post(o,e,u)}).catch(t=>this.traceWith("wix-data retry handler",{retriesLeft:e,httpStatus:t?.response?.status,error:t,isGetRequest:r})(()=>r&&e>0&&503===t?.response?.status?u(e-1):Promise.reject(t)));return u(2).catch(ft(this.traceWith)).then((l=this.traceWith,e=>l("platformized-data-response",{requestId:e.headers?.["x-wix-request-id"]})(()=>(0,ht.d)(e.data))));var l})}_getGridAppId(){return Promise.resolve(Et(this.gridAppId)?this.gridAppId.get():this.gridAppId)}_traceWith(e,t){return r=>this._getGridAppId().then(i=>this.traceWith(e,{gridAppId:i,environment:this.environment,...t})(r))}}function Ot(e){return{appOptions:e?.appOptions,suppressHooks:e?.suppressHooks,fields:e?.fields,consistentRead:e?.consistentRead,language:e?.language,includeReferencedItems:e?.includeReferences,...e?.showDrafts?{publishPluginOptions:{includeDraftItems:!0}}:{}}}var Dt,Ct,Tt;!function(e){e.LIVE="LIVE",e.SANDBOX="SANDBOX",e.TRASH_LIVE="TRASH_LIVE"}(Dt||(Dt={})),function(e){e.ASC="ASC",e.DESC="DESC"}(Ct||(Ct={})),function(e){e.ASC="ASC",e.DESC="DESC"}(Tt||(Tt={}));const jt=()=>e=>e();function wt({cloudDataUrl:e="/_api/cloud-data",gridAppId:t,segment:r,environment:i,httpClient:n,authHeader:a,traceWith:s=jt}){const o=i||(r===Dt.LIVE?Le.LIVE:Le.SANDBOX);return new at(new St({cloudDataUrl:e,gridAppId:t,environment:o,httpClient:n,authHeader:a,traceWith:s}))}const Pt="data";function kt({featureConfig:e,platformUtils:{sessionService:t},appEssentials:r,platformEnvData:{site:i,session:n},appDefinitionId:a,blocksAppsUtils:s}){const o={get(){const{isRunningInDifferentSiteContext:e}=n,r=t.getInstance(a);if(s.isFixWixDataInstanceForBlocksPreviewExperimentOpen()&&e||s.isBlocksApp(a)&&s.canAppInstanceBeUsedForAuthorization(r)){if(!r)throw new Error(`No app instance found for appDefinitionId: ${a}`);return r}return t.getWixCodeInstance()}},u=Boolean(i.experiments["specs.thunderbolt.UseCloudDataUrlWithBaseExternalUrl"]),{gridAppId:l,environment:c,cloudDataUrl:d,cloudDataUrlWithExternalBase:h}=e,{httpClient:m}=r;return{[Pt]:wt({cloudDataUrl:u?h:d,httpClient:m,gridAppId:l,environment:c,authHeader:o})}}}}]);
//# sourceMappingURL=feature-data-wix-code-sdk.31cfb098.chunk.min.js.map